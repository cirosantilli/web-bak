<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>JavaScript Cheatsheet</title>
  <link rel="shortcut icon" type="image/x-icon" href="flower.jpg" />
  <style>
   .border { border:1px solid black; }
   pre {
     border:1px solid black;
     background-color: #EEE;
     padding: 5px;
   }
  </style>
  <script src="assert.js"></script>

  <!-- Not part of the cheat: only to improve usability. -->

    <script src="http://code.jquery.com/jquery-1.10.2.min.js"></script>
    <script src="jquery.toc.js"></script>
    <script src="https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js"></script>
    <script>
      $('#toc').toc({
        content: 'div.content',
        headings: 'h1,h2,h3,h4,h5,h6'
      });
    </script>
    <link rel="stylesheet" href="/assets/header-link.css"/>
</head>
<body onload="document.getElementById('onload').innerHTML = 'onload'">
<h1>JavaScript Cheatsheet</h1>

<ol data-toc></ol>

<h2>About</h2>

  <p>
    Every script tag in this cheat is HTML escaped and put inside a pre element after its script
    by a script so you can see it. Scripts are styled like this:
  </p>
  <script>
    // Inside script element.
    var a = 1
  </script>
  <p>
    This cheatsheet is designed to work in modern ES5 compliant browsers.
    No effort was made to account for incompatibilities.
  </p>
  <p>
    Content is currently being converted from Js comments to HTML + scripts.
    This explains the remaining huge script blocks with many useful comments.
  </p>

  <h3>Helper methods</h3>

    <p>The following helper methods are used on this cheat:</p>

    <script>
      var previousElement = function() {
        return document.currentScript.previousElementSibling
      }

      var insertBeforeScript = function(elem) {
        document.currentScript.parentNode.insertBefore(elem, document.currentScript)
      }

      var strToElement = function(str) {
        var dummy = document.createElement('div')
        dummy.innerHTML = str
        return dummy.childNodes[0]
      }

      // Make the script elements visible.
      document.addEventListener(
        'DOMContentLoaded',
        function() {
          Array.prototype.slice.call(document.getElementsByTagName('script')).forEach(function(elem) {
            elem.insertAdjacentHTML('afterEnd', '<pre class="prettyprint">'
              + elem.innerHTML.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;")
              + '</pre>'
            )
          })
        },
        true
      )
    </script>

<h2>#Introduction</h2>

  <p>JavaScript is a language originally designed to run in a browser.</p>
  <p>
    More recently, it has also been used outside of browsers, often server side, through Node.js.
    This cheat shall consider mostly a world without Node.js: for a Node.js cheat see:
    <a href="https://github.com/cirosantilli/nodejs">https://github.com/cirosantilli/nodejs</a>
  </p>
  <p>
    It can be embedded on the HTML given by the server to the browser inside <code>script</code> tags.
    It can also be given in separate <code>.js</code> files which are then included in the HTML header.
  </p>
  <p>
    One of the goals of JavaScript is to restrict what the language can do to prevent malicious attacks.
    Therefore, by design choice JavaScript does not allows dangerous operations such as file IO
    (this might be possible soon with: <a href="http://www.w3.org/TR/FileAPI/">the File API</a>)
    Node.js adds such abilities to JavaScript through its standard library.
  </p>
  <p>
    JavaScript feels very Pythonic, but with less features and stdlib.
    CoffeScript "Rubynises" it.
  </p>
  <h3>#CoffeeScript</h3>
    <p>
      JavaScript is known for having some weird quirks. CoffeScript, a language that transpiles to JavaScript
      but behaves more like Ruby, attempts to correct many of those quirks.
    </p>
  <h3>#TypeScript</h3>
    <p>
      Microsoft open source Js extension: every valid Js script also a valid TypeScript one.
      Possible to compile it down to vanilla JavaScript.
    </p>

<h2>#Standards</h2>

<h2>#ECMAScript</h2>

  <p>Official language name: ECMA-262, or ECMAScript.</p>
  <p>Versions are often abbreviated as: ES5, ES6, etc.</p>
  <p>
    ECMAScript is developed by ECMA: it is therefore one of the few
    key web standards not maintained by W3C.
  </p>
  <p>
    The ECMA work group that develops JavaScript is called T39.
    They have a wiki at: <a href="http://wiki.ecmascript.org">http://wiki.ecmascript.org</a>
    where they organize the proposals for the next version of the standard,
    including features prior to approval on the strawman namespace
    <a href="http://wiki.ecmascript.org/doku.php?do=index&amp;id=strawman%3Astrawman">http://wiki.ecmascript.org/doku.php?do=index&amp;id=strawman%3Astrawman</a>
    The wiki is openly readable, but only writable by contributors.
  </p>
  <p>
    ECMAScript does not include objects which browsers add to JavaScript
    such as <code>document</code>, <code>window</code>, <code>XMLHttpRequest</code>,
    although it does furnish some global objects like JSON.
    Such objects are typically specified in separate W3C specs.
  </p>
  <p>
    Browser objects are not directly available to Node.js, including useful ones such as <code>XMLHttpRequest</code>.
    Some projects implement the browser interfaces as a Node.js library, such as
    <a href="https://github.com/driverdan/node-XMLHttpRequest">https://github.com/driverdan/node-XMLHttpRequest</a>
    thus allowing to use such objects in Node.js / browser portable code./
  </p>

  <h3>#ES6</h3>

    <p>6, AKA #harmony</p>
    <p>Expected Dec 2014.</p>
    <p>
      Official PDF drafts:
      <a href="http://wiki.ecmascript.org/doku.php?id=harmony:specification_drafts">http://wiki.ecmascript.org/doku.php?id=harmony:specification_drafts</a>
    </p>
    <p>
      Officially approved features list under the Harmony namespace of the official wiki:
      <a href="http://wiki.ecmascript.org/doku.php?do=index&amp;id=harmony%3Aharmony">http://wiki.ecmascript.org/doku.php?do=index&amp;id=harmony%3Aharmony</a>
    </p>
    <p>
      Unofficial HTML version of the draft by one of the contributors:
      <a href="http://people.mozilla.org/~jorendorff/es6-draft.html">http://people.mozilla.org/~jorendorff/es6-draft.html</a>
      The official versions are in PDF.
    </p>
    <p>Good cheat: <a href="https://github.com/lukehoban/es6features">https://github.com/lukehoban/es6features</a></p>
    <p>
      Promises: <a href="http://www.html5rocks.com/en/tutorials/es6/promises/">http://www.html5rocks.com/en/tutorials/es6/promises/</a>
      Currently usable through several libraries.
    </p>
    <p>
      Modules: attempts to unify CommonJS and AMD and end the mess.
      <a href="http://www.html5rocks.com/en/tutorials/es6/promises/">http://www.html5rocks.com/en/tutorials/es6/promises/</a>
      Currently usable with by transpiling:
      <a href="https://github.com/square/es6-module-transpiler">https://github.com/square/es6-module-transpiler</a>
      Tutorials:
      <a href="http://www.2ality.com/2013/07/es6-modules.html">http://www.2ality.com/2013/07/es6-modules.html</a>
    </p>

  <h3>#ES5</h3>

    <p>5.1, 2011: <a href="http://www.ecma-international.org/ecma-262/5.1/">http://www.ecma-international.org/ecma-262/5.1/</a></p>
    <p>5: 2009.</p>
    <p>Generally implemented.</p>
    <p>Fully implemented by Google's V8 engine for Chrome and Node.js.</p>
    <p>http://www.ecma-international.org/publications/standards/Ecma-262.htm</p>

  <h3>#ES4</h3>

    <p>was aborted</p>

  <h3>#ES3</h3>

    <p>1999</p>

<h2>#Detect JavaScript #version</h2>

  <p>Not possible?! <a href="http://stackoverflow.com/questions/7340726/detect-version-of-javascript">http://stackoverflow.com/questions/7340726/detect-version-of-javascript</a></p>
  <p>People recommend checking for individual features instead.</p>

<h2>#Sources</h2>

  <p>Besides the standards, also check out:</p>
  <ul>
    <li>
      Mozilla Developer Network.
      <a href="https://developer.mozilla.org">https://developer.mozilla.org</a>
      Lots of examples and comments about the standards and implementation status in other browsers.
    </li>
    <li>
      Some useful simple design patterns by GitHub:
      <a href="https://github.com/styleguide/javascript/1.0">https://github.com/styleguide/javascript/1.0</a>
    </li>
  </ul>

<h2>#Style</h2>

  <ul>
    <li>
      GitHub's: <a href="https://github.com/styleguide/javascript">https://github.com/styleguide/javascript</a>
      <ul>
        <li>2 space indent</li>
        <li>no semicolons</li>
      </ul>
    <li>
      Google: <a href="http://google-styleguide.googlecode.com/svn/trunk/javascriptguide.xml">http://google-styleguide.googlecode.com/svn/trunk/javascriptguide.xml</a>
      <ul>
        <li>2 space indent</li>
        <li>semicolons</li>
        <li>single quoted strings by default. Easier to include HTML with attributes, which in their style uses double quotes.</li>
      </ul>
    </li>
    <li>
      Airbnb; <a href="https://github.com/airbnb/javascript">https://github.com/airbnb/javascript</a>
      <ul>
        <li>semicolons</li>
      </ul>
    </li>
  </ul>

<h2>#Minification</h2>

  <p>Since JavaScript is sent to browsers over the network, methods have been developed to make JavaScript code smaller:</p>

  <h3>#Compression</h3>

    <p>Compress JavaScript with gzip before sending. Notify browser with <code>Content-Encoding</code> HTTP header.</p>

  <h3>#Minification</h3>

    <p>Remove unnecessary characters like whitespaces.</p>

  <h3>#Obfuscation</h3>

    <p>
      Rename variables and functions to shorter names, factor things out in ways
      that are shorter but hard for humans to understand.
    </p>

  <h3>#Concatenation</h3>

    <p>Concatenate multiple Js files together.</p>
    <p>
      OK, not really a form of compression, but serves the same purpose: make things faster,
      in this case by reducing the number of HTTP requests.
    </p>
    <p>
      When writing JavaScript code, you must be aware that this can happen, and that it may have consequences.
      See for example the Semicolon before IIFE pattern.
    </p>

<h2>#script element</h2>

  <h3>Where JavaScript code can be placed</h3>

    <ul>
      <li>on external <code>.js</code> files and included with <code>script src=</code></li>
      <li>inside a script element</li>
      <li>on certain callback attributes like <code>onclick</code>, whose usage is discouraged.</li>
    </ul>

  <h3>#script element</h3>

    <p><code>script</code> elements can appear either inside the head or of the body.</p>
    <p>
      The most commonly recommended place is load all scripts just before the closing <code>body</code> tag,
      so that the page can load before long scripts do, so it seems more responsive.
    </p>
    <p>
      It is not valid to put scripts after the <code>body</code> tag, as HTML specifies that only
      comments can be put there.
    </p>

  <h3>#Multiple script elements</h3>

    <p>Scripts are executed in the order which they appear on the file.</p>
    <p>head scripts are executed before body ones.</p>
    <p>Definitions from previous scripts blocks are kept for future script blocks:</p>
    <script>
      var i = 1
    </script>
    <script>
      assert_eq(i, 1)
    </script>
    <p>
      Errors and uncaught exceptions (e.g. undefined variables) only stop execution of the current script block:
      future script blocks still execute. There is no way to prevent future script blocks from executing.
    </p>
    <script>
      //global_undefined
    </script>

  <h3>#src attribute</h3>

    <p>Source a script from a separate <code>.js</code> file.</p>
    <p>
      The included script behaves exactly as a script inside a <code>script</code> element:
      it can for example get and set cookies. Therefore, when you include a third-party script you
      must future-trust the source or they can hack your users away.
    </p>
    <p>
      In HTML5, the <code>script</code> tag *cannot* be self closing
      because it is neither void nor foreign.
    </p>
    <p>
      In HTML5 you cannot have <code>src</code> and a non-empty <code>innerHTML</code>:
      <a href="http://stackoverflow.com/questions/6528325/what-does-a-script-tag-with-src-and-content-mean">http://stackoverflow.com/questions/6528325/what-does-a-script-tag-with-src-and-content-mean</a>
    </p>
    <script src="external.js"></script>
    <script>
      assert_eq(external, 1)
    </script>

    <h3>#async attribute</h3>

      <p>It is possible to run external scripts asynchronously.</p>
      <p>This makes script run other unpredictable.</p>
      <p>Can only be used for external scripts.</p>
      <script src="external.js" async></script>

  <h3>#type attribute</h3>

    <p>
      Before HTML5 it was mandatory to specify the language of the script as an
      attribute to the script tag: <code>type="text/javascript"</code>
    </p>
    <p>In HTML5 js became the default, so the attribute is not needed anymore.</p>

  <h3>#/scr'+'ipt</h3>

  <h3>Close script tag inside string inside JavaScript</h3>

    <p>
      Any HTML tags can be included inside a script element except the closing script tag.
      The HTML parser just reads everything up to that and then passes it to the Js interpreter.
    </p>
    <p>
      A common technique to write a literal &lt;/script&gt; string inside JavaScript it to break it up
      with concatenation as <code>/scr'+'ipt</code>
    </p>

  <h3>#use strict directive</h3>

  <h3>#Strict mode</h3>

    <p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions_and_function_scope/Strict_mode">https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions_and_function_scope/Strict_mode</a></p>
    <p>ES5.</p>
    <p>Throws exceptions in a bunch of extra smelly cases.</p>
    <p>
      Seems to be the only current directive,
      although there are extension directives like asm.js <code>"use asm"</code>
    </p>

    <p>Turn on for entire script element:</p>
    <script>
      'use strict'
      assert_throws(
        function() {
          01
        },
        SyntaxError
      )
    </script>

    <p>Turn on for single function:</p>
    <script>
      assert_throws(
        function() {
          'use strict'
          01
        },
        SyntaxError
      )

      // TODO why passes?
      assert_throws(
        function() {
          'use strict'
          01
        },
        'asdf'
      )

      assert_not_raises(
        function() {
          01
        }
      )
    </script>

<h2>#semicolon</h2>

<h2>;</h2>

  <p>Separates statements.</p>

  <script>
    var i = 1; i = 2;
    assert_eq(i, 2);
  </script>

  <h3>#ASI</h3>

    <p>Good tutorial <a href="http://inimino.org/~inimino/blog/javascript_semicolons">http://inimino.org/~inimino/blog/javascript_semicolons</a></p>
    <p>Automatic semicolon insertion.</p>
    <p>In most cases, semicolons are automatically added by the parser at newlines:</p>
    <script>
      var i = 1
      i = 2
      assert_eq(i, 2)
    </script>
    <p>There are a few complex cases however.</p>
    <p>Operators inhibit ASI to allow programmers to write:</p>
    <script>
      var i = 1 +
      1
      assert_eq(i, 2)

      var i = 1
        + 1
      assert_eq(i, 2)
    </script>
    <p>
      Because of ASI, many people use a coding style without semicolons,
      using them only for the only exception: lines that start with parenthesis:
    </p>
    <script>
      var i = 1
      ;(assert_eq(i, 1))
    </script>
    <p>One notable case where this happens is for IIFE scope preservation.</p>
    <p>TODO why are semicolons are not required are in single line functions:</p>
    <script>
      var f = function() { return 0 }
      assert_eq(f(), 0)
      //Instead of:
      var f = function() { return 0; }
    </script>
    <p>Advantages of using semicolons:</p>
    <ul>
      <li>
        slightly saner because you don't have to think if it will be added or not automatically,
        but only slightly because the no insertion rule is intuitive, except for the parenthesis case.
      </li>
      <li>
        slightly better for framework concatenation and minification,
        but only slightly because good tools should be able to work around that, and the better compression
        method is gzipping it anyways.
      </li>
    </ul>
    <p>It is a controversial subject which style is better. This is one of the things CoffeScript takes care of.</p>
    <p>GitHub style says no semicolons. Rationale: http://mislav.uniqpath.com/2010/05/semicolons/</p>
    <p>Google says semicolons. Rationale: http://google-styleguide.googlecode.com/svn/trunk/javascriptguide.xml#Semicolons</p>

<h2>#comments</h2>

  <p>Like C++.</p>
  <script>
    // Single line.

    /*
      Multi
      line.
    */
  </script>

<h2>#identifiers</h2>

  <p>
    Identifiers can contain very weird characters.
    <a href="http://stackoverflow.com/questions/1661197/valid-characters-for-javascript-variable-names">http://stackoverflow.com/questions/1661197/valid-characters-for-javascript-variable-names</a>
  </p>
  <p>The first character is more restricted than the following ones, for example it cannot be a number.</p>
  <p>
    Some libraries make extensive use of such variables, notably JQuery which uses the dollar sign <code>$</code>
    which is an alias for jQuery.
  </p>
  <p>Make sure to use <code>meta charset=UTF-8</code> if you really want to use non ASCII identifier chars.</p>
  <script>
    ;(function () {
      var $ = 0
      assert_eq($, 0)

      var ᾏ = 0
      assert_eq(ᾏ, 0)
    }())
  </script>

  <h3>#case</h3>

    <p>JavaScript is case sensitive.</p>
    <script>
      var i = 1
      var I = 2
      assert_eq(i, 1)
      assert_eq(I, 2)
    </script>
    <p>
      It is unfortunate that many standard classes use all uppercase case for initials
      or even worse: mixed standards like the insane <code>XMLHttpRequest</code>,
      which has two case standards on a single identifier:
      <code>XML</code> all uppercase and (insane) and <code>Http</code> camel.
    </p>

<h2>#scope</h2>

  <p>
    Only functions with <code>var</code> generate new scopes,
    not blocks like <code>if</code> in general.
  </p>
  <script>
    var a = 0
    {
      var a = 1
    }
    assert_eq(a, 1)

    var a = 0
    ;(function() {
      var a = 1
    }())
    assert_eq(a, 0)
  </script>

<h2>#operators</h2>

  <h3>#tilde operator</h3>

  <h3>#~</h3>

    <p>Binary negation.</p>
    <p>Common application: transform <code>-1</code> into <code>0</code> on <code>indexOf</code> (jQuery <code>inArray</code>).</p>
    <p>Works because number representation is fixed at 2's complement and in that case:</p>
    <ul>
      <li><code>~-1 == 0</code>~-1 == 0</li>
      <li>there is no other number such that <code>~x == 0</code></li>
    </ul>

    <script>
      assert_eq(~-1,  0)
      assert_eq(~ 0, -1)
    </script>

  <h3>#comma operator</h3>

    <script>
      i = 1, j = 2
      assert_eq(i, 1)
      assert_eq(j, 2)
    </script>

  <h3>#void operator</h3>

    <p>Evaluates expression and returns <code>undefined</code>.</p>
    <p>
      TODO applications, besides golfing for <code>undefined</code>, specially on discouraged <code>javascript:void(0)</code> hrefs: ?
      <a href="http://stackoverflow.com/questions/1291942/what-does-javascriptvoid0-mean">http://stackoverflow.com/questions/1291942/what-does-javascriptvoid0-mean</a>
    </p>

    <script>
      var a = 0
      assert_eq(void(a = 1), undefined)
      assert_eq(a, 1)
    </script>

    <p>
      Since this is an operator, the parenthesis are not required. If added,
      what is inside of them is evaluated, so it also works:
    </p>

    <script>
      assert_eq(void 0,  undefined)
      assert_eq(void(0), undefined)
    </script>

    <p>
      But it might be required to avoid some parsing errors like
      <code>ReferenceError: invalid assignment left hand side</code>:
    </p>

    <script>
      //void a = 0
    </script>

    <h4>#javascript: URI scheme</h4>

    <h4>#javascript:void(0);</h4>

    <h4>#javascript:;</h4>

      <p>
        Bad practice:
        <a href="http://stackoverflow.com/questions/1291942/what-does-javascriptvoid0-mean">http://stackoverflow.com/questions/1291942/what-does-javascriptvoid0-mean</a>
        Only use links for links: for other things use styled spans.
      </p>
      <p>Evaluate JavaScript and open it on the new page if the result is not <code>undefined</code>.</p>
      <p>TODO: W3C standard? Likely not, since not even in IANA.</p>
      <p>
        If <code>undefined</code>, do nothing, and unlike number sign URL,
        <code>#</code>don't go to the top of the page.
      </p>
      <p>
        Often used with <code>void(0)</code>, which is golf for <code>undefined</code> to make links
        which trigger scripts instead of opening pages. Used because the <code>href</code>
        attribute is mandatory for valid HTML.
      </p>
      <p>TODO: vs <code>javascript:;</code></p>
      <p>
        Also used instead of straight <code>undefined</code> because <code>undefined</code>
        can be redefined to something else, while <code>void</code> can't.
      </p>
      <p>
        Major problem with that technique: middle click still opens up a new tab / window
        with address <code>javascript:void(0)</code> that shows nothing on the screen.
      </p>
      <p>Yes, go ahead and type <code>javascript:something</code> on you browser URL, it will work.</p>
      <div><a href="javascript:1+1">javascript:1+1</a></div>
      <div><a href="javascript:void(0)">javascript:void(0)</a></div>
      <div><a href="#">#</a></div>
      <div><a href="javascript:;">javascript:;</a></div>
      <div><a href="javascript:">javascript:</a></div>
<script>
// TODO: convert comments on this script to HTML

// #if

  // http://www.ecma-international.org/ecma-262/5.1/#sec-12.5

    if (false) {
      assert(false)
    } else {
    }

    if (true) {
    } else {
      assert(false)
    }

  // Like Python, some objects are converted to true, others to false.

  // Only the following are false:

    if (0) {
      assert(false)
    } else {
    }

    if ("") {
      assert(false)
    } else {
    }

    if (null) {
      assert(false)
    } else {
    }

    if (undefined) {
      assert(false)
    } else {
    }

    if (NaN) {
      assert(false)
    } else {
    }

  // All others are true.

    if (-1) {
    } else {
      assert(false)
    }

    if (1) {
    } else {
      assert(false)
    }

    if ("a") {
    } else {
      assert(false)
    }

    if ([]) {
    } else {
      assert(false)
    }

// #for

  // C like:

    var total = 0
    for (var i = 0; i < 3; i++) {
      total += i
    }
    assert_eq(total, 3)

  // For in: iterates over **object properties**!

    var total = 0
    var obj = {'a': 1, 'b': 2}
    for (var x in obj) {
      total += obj[x]
    }
    assert_eq(total, 3)

// #continue

// #break

  // Both have a label and label-less form.

  // Label-less form is the same as C.

  // break:    without label only inside loops, with valid in any code block.
  // continue: with or without label only inside loops.

    var total = 0;
    for (var i = 0; i < 3; i++) {
      if (i == 1)
        continue
      total += i
    }
    assert_eq(total, 2)

  // TODO understand label form. Good examples: http://www.tutorialspoint.com/javascript/javascript_loop_control.htm

// #Primitive types

// #Base types

// #Mutable

// #Immutable

  // http://javascriptweblog.wordpress.com/2010/09/27/the-secret-life-of-javascript-primitives/

  // There are 5 primitive types in JavaScript:

  // - undefined
  // - null
  // - boolean
  // - string
  // - number

  // Everything else is an object.

  // Of the primitive types, `boolean`, `string` and `number` have corresponding Object wrappers: Boolean, String.

  // This is so to allow to simulate the property syntax to those primitive types.

  // You can however get the original object through `#valueOf`

  // Types are as follow:

    //typeof true;                          //"boolean"
    //typeof Boolean(true);                 //"boolean"
    //typeof new Boolean(true);             //"object"
    //typeof (new Boolean(true)).valueOf(); //"boolean"

  // This implies that:

    assert_eq(0, Number(0))
    assert_eq(0, new Number(0).valueOf())
    assert_neq(typeof(0), new Number(0))

  // Unlike objects, primitives have no properties.

  // JavaScript does implicit coercion between primitives and corresponding types
  // whenever you try access a property of a primitive:

    assert_eq('abc'.length, 3)

  // This creates a String object for a moment, returns the `length`, and then garbage collection kills it.

  // This means that it is not possible to modify a primitive, and the modification happens on the coerced object instead:

    a = 0
    a.b = 1
    assert_eq(a.b, undefined)

  //#==

    // http://www.ecma-international.org/ecma-262/5.1/#sec-11.9.3

    // You never want to use this because it does insane conversions.
    // Use `===` instead.

      assert(null  == undefined)
      assert(null !== undefined)

      assert(1     == '1')
      assert(1    !== '1')

      assert(true   == 1)
      assert(true   != 2)
      assert(true  !== 1)
      assert(true  !== 2)

  //#===

    // Operators behave as expected on primitives. In particular,
    // `===` compares their values, not addresses, so for primitives it works as naively expected:

      assert(true  === true)
      assert(0     === 0)
      assert('abc' === 'abc')

    // while it fails for objects, where address is considered:

      assert([] !== [])
      assert({} !== {})

// #undefined

  // There is an undefined constant.

    var a = undefined
    assert_eq(a, undefined)

  // ERROR: Using undeclared variables leads to an error:

    //global_undefined

  // Undefined appears automatically from failed property lookup:

    assert_eq({}.no_yet_defined, undefined)

  //#Check if variable is undefined

    // Before ES5, it was possible to redefine `undefined` TODO check, in ES5?
    // so the safest way to check for undefined is via `typeof`:

      ;(function() {
        var global_undefined
        // Safe all versions:
        assert_eq(typeof(global_undefined), 'undefined')
        // Safe starting from JS5:
        assert_eq(global_undefined, undefined)
      })()

    // Only `typeof` can be used however for variables that might be undeclared (`var`):

      assert_eq(typeof(global_undeclared), 'undefined')

    // Undefined can be assigned to: TODO true?

      ;(function() {
        var undefined = 0
        assert_eq(undefined, 0)
      })()

    // If you ever to that, it's gone for good: TODO true?

// #null

  // Null vs undefined: http://stackoverflow.com/questions/801032/why-is-null-an-object-and-whats-the-difference-between-null-and-undefined

// #floating point

  // Also numbers:

    assert_eq(typeof(0), typeof(0.5))

// #string

  // Both `'` and `"` are identical, except for escaping themselves.

  // Google style says prefer `'` since it makes it easier to embed HTML, whose attributes use double quotes `"`.

    var s = "abc"
    var s = 'abc'
    var s = "\n"
    var s = '\n'
    assert_eq("\n", '\n')
    var s = "'"
    var s = '"'

  // #compare

    // Strings are immutable, therefore comparison works as expected:

      assert_eq('a', 'a')

  // #multiline string literals

    //#without newlines inserted

      // http://stackoverflow.com/questions/805107/creating-multiline-strings-in-javascript

      // More efficient, less sane when changing indentation levels:

        assert_eq('a\
 b', 'a b')

      // Less efficient unless optimized, saner when changing indentation levels, Google style:

        assert_eq('a' +
            'b', 'ab')

    // In ES6 there will be a backtick quoted multiline literal called `NoSubstitutionTemplate`.

      //var htmlString = `Say hello to
//multi-line
//strings!`

  // #replace

    // Perl-like regex replace

      assert_eq('a0ba1b'.replace(/a(.)b/g, '$1'), '01')

  // #concat #+

    // Creates new string that is the concatenation of two others.

      var s = 'a'
      assert_eq(s + 'b', 'ab')
      assert_eq(s, 'a')

      var s = 'a'
      assert_eq(s.concat('b'), 'ab')
      assert_eq(s, 'a')

      assert_eq('a'.concat('b').concat('c'), 'abc')

  // #lower #upper

      assert_eq('ab'.toUpperCase(), 'AB')
      assert_eq('AB'.toLowerCase(), 'ab')

  // #new String vs #String

    // Explicit constructor is also available.

    // Unlike for Array which is an object, `String()` and `new String()` do different things:
    // `new Strings` generates an object wrapper, while `String()` generates the primitive.

    // There is almost never reason to use `new String()`

      assert('' === String())
      assert('' !== new String())
      assert(''  == new String())

      assert_eq(typeof(String()),     'string')
      assert_eq(typeof(new String()), 'object')

  // #convert variable to string

    // <stackoverflow.com/questions/5765398/whats-the-best-way-to-convert-a-number-to-a-string >

    // Alternatives:

    // - `x.toString()`: undefined for `null`. Simple to override. My preferred option.
    // - `String()`:     works for `null`, but returns `null` in that case, not `''`.
    // - `'' + n`:       possibly slower, less clear.

      assert_eq(String(null),       'null')
      assert_eq(String(undefined),  'undefined')
      assert_eq(String(0),          '0')
      assert_eq(String([0, 1]),     '0,1')
      assert_eq(String({a:0, b:1}), '[object Object]')

  // #escape

    // URL encode:

      assert_eq(escape(' '), '%20')
      assert_eq(unescape(escape(' ')), ' ')

    // HTML anti XSS:

      // < to &lt;, etc.

      // No built-in solution: http://stackoverflow.com/questions/24816/escaping-html-strings-with-jquery

// #dict #map #class

  // Everything except the few primitives types are objects.

  // There is no dict in JavaScript, but objects behave just like dicts.
  // This is an interesting design choice, since Objects in languages such as Python or Ruby
  // behave much like maps, so why not remove them entirely?

  // Classes don't exist in JavaScript: they are more of a design pattern with a little
  // syntax support than an integral part of the language.

  // #sources

    // - http://yehudakatz.com/2011/08/12/understanding-prototypes-in-javascript/
    // - http://stackoverflow.com/questions/572897/how-does-javascript-prototype-work

  // #property #[] #.

    // Attributes can be accessed either via `.` or `[]`.

    // `[]` is more flexible, as it can take any string,
    // while `.` can only take attributes that follow certain rules
    // (TODO which), including not starting with digits.

      var o = {a:0, 'b':1, 2:2}

      assert_eq(o.a,    0)
      assert_eq(o['a'], 0)

      assert_eq(o.b,    1)
      assert_eq(o['b'], 1)

    // ERROR: attribute cannot start with digit for dot `.` notation.

      //assert_eq(o.2, 2)

      assert_eq(o[2],   2)
      assert_eq(o['2'], 2)

    // property lookup order

      // 1) Look in properties of object defined with `defineProperty` or `=`.
      // 2) If not found, look at [[Prototype]] attributes.
      // 3) If not found, look at [[Prototype]].[[Prototype]] attributes, and so on, until `null` if found.
      //     In that case, return `undefined`.

  // #Object #Object.create

    // Low level object operations.

    // It is a function like any other "class":

      assert_eq(typeof(Object), 'function')

    // Simplest object:

      var o = Object.create(null)

    // The argument is the prototype:

      assert_eq(Object.getPrototypeOf(o), null)

    // #defineProperty

      // Low level interface for `a.b = c`.

      // Allows further customizations of the property.

      // Some of the default of this function differ from the defaults
      // given by `a.b = c`, e.g. `configurable` and `enumerable` are:

      // - true for `=`
      // - false for `defineProperty`

      // Define some properties:

        Object.defineProperty(o, 'x', {
          configurable: true,
          enumerable: true,
          value: 1,
          writable: true,

          // See getter and setter.
          //get: function
          //set:
        })

    // #enumerable

      // Only enumerable properties show up in `for in`.

      // useful to ignore "internals" like `constructor` and other properties:
      // http://stackoverflow.com/questions/17893718/what-does-enumerable-mean

    // Exact same as above: defaults writeable, enumerable and configurable to true.

      o.y = 2

    // Can also set it to a function.

      o.sum = function() {
        return this.x + this.y
      }

      var o2 = Object.create(o)
      assert_eq(Object.getPrototypeOf(o2), o)

      o2.x = 11

      assert_eq(o.x, 1)
      assert_eq(o.y, 2)
      assert_eq(o.sum(), 3)
      assert_eq(o2.x, 11)
      assert_eq(o2.y, 2)

      assert_eq(o.z, undefined)

  // #prototype #[[Prototype]]

    // Exists to allow inheritance-like constructs.
    //
    // There are two *distinct* things called prototype:
    //
    // - a public `prototype` attribute, as in `[].prototype`.
    //
    // - an inaccessible one, called an "Object Internal Property and Methods" on section 8.6.2 of ES5,
    //     and denoted [[Prototype]] in the standard. Firefox makes this property visible through `__proto__`,
    //     but this is not mentioned in the standard.
    //
    //     This is the one used for the property lookup.
    //
    // The relationship between them is:
    // when an object is constructed, the object's `[[Prototype]]` is set to `obj.prototype`.

    // When you do:

      var F = function() {}
      var f = new F()

    // You get:

      /*
      (Function)       (  F  )                                      (f)
      |                | | ^                                        |
      |                | | |                                        |
      |                | | +-------------------------+              |
      |                | |                           |              |
      |                | +--------------+            |              |
      |                |                |            |              |
      |                |                |            |              |
      |[[Prototype]]   |[[Prototype]]   |prototype   |constructor   |[[Prototype]]
      |                |                |            |              |
      |                |                |            |              |
      |                |                | +----------+              |
      |                |                | |                         |
      | ---------------+                | | +-----------------------+
      | |                               | | |
      v v                               v | v
      (Function.prototype)              (F.prototype)
      |                                 |
      |                                 |
      |[[Prototype]]                    |[[Prototype]]
      |                                 |
      |                                 |
      | +-------------------------------+
      | |
      v v
      (Object.prototype)
      | | ^
      | | |
      | | +---------------------------+
      | |                             |
      | +--------------+              |
      |                |              |
      |                |              |
      |[[Prototype]]   |constructor   |prototype
      |                |              |
      |                |              |
      |                | -------------+
      |                | |
      v                v |
      (null)           (Object)
      */

    // The chain ends at:

      assert_eq(Object.getPrototypeOf(Object.prototype), null)
      assert_eq(Object.getPrototypeOf(F), Function.prototype)
      assert_eq(Object.getPrototypeOf(F.prototype), Object.prototype)
      assert_eq(Object.getPrototypeOf(f),  F.prototype)
      assert_eq(Object.getPrototypeOf({}), Object.prototype)

    // #constructor

      // Normally constructor is not automatically found on new objects,
      // but found by lookup on `[[Prototype]]`:

        assert(!f.hasOwnProperty('constructor'))
        assert(!F.hasOwnProperty('constructor'))
        assert_eq(f.constructor, F)
        assert_eq({}.constructor, Object)
        assert_eq(''.constructor, String)
        assert(F.prototype.hasOwnProperty('constructor'))

      // The constructor of every function is a function.

        assert_eq(Object.constructor, Function)
        assert_eq(typeof(Object), 'function')
        assert_eq(Function.constructor, Function)
        assert_eq(typeof(Function), 'function')
        assert_eq(Array.constructor, Function)
        assert_eq(typeof(Array), 'function')
        assert_eq(F.constructor, Function)
        assert_eq(typeof(F), 'function')

      // Unless you hack things up, `prototype.constructor` returns to the object itself.

        assert_eq(Object.prototype.constructor,   Object)
        assert_eq(Array.prototype.constructor,    Array)
        assert_eq(Function.prototype.constructor, Function)
        assert_eq(F.prototype.constructor,        F)

    // prototype is not automatically set set on new objects:

      assert_eq(f.prototype,  undefined)
      assert_eq({}.prototype, undefined)

    // If you modify the prototype without making it a new object, you can add new
    // properties to all objects that have it as [[Property]]:

      F.prototype.a = 1
      assert_eq(f.a, 1)

    // BAD This is also possible if you set prototype itself to be another object.
    // But don't do that, as automatically set properties like `constructor` will
    // get weird values.

      var F = function() {}
      F.prototype = {a:1}
      var f = new F()
      assert_eq(f.a, 1)
      // Not F! Because constructor used to come from `F.prototype`,
      // and now it comes from Object.prototype because {}.__proto__ == Object.prototype.
      assert_eq(f.constructor, Object)

    // #getPrototypeOf #__proto__

      // `Object.getPrototypeOf` returns the `[[Prototype]]`.

      // `__proto__` is a de facto standard which does the same, but is not in ES5.

      // Same as `obj.constructor.prototype`: http://stackoverflow.com/questions/8024879/is-object-getprototypeof-same-as-object-constructor-prototype-in-javascript

        assert_eq(Object.getPrototypeOf([]), [].constructor.prototype)
        assert_eq([].constructor, Array)

      // Primitives don't have prototypes. `TypeError`:

        //Object.getPrototypeOf(0)

  // #Object Literals

      var o = {x:0, y:1}

    // Is the same as:

      //var o = Object.create(Object.prototype);
      //o.x = 0
      //o.y = 1

    // This means that the object literal "inherits" from the same class as Object,
    // and gets many of its useful methods.

    // Proof:

      assert_eq(o.x, 0)
      assert_eq(o.y, 1)
      assert_eq(Object.getPrototypeOf(o), Object.prototype)

    // #What can be used as key

      // Keys in literals must be either:
      //
      // - identifiers
      // - string literals
      // - numeric literals
      //
      // Anything else breaks up, including:
      //
      // - variables
      // - return value of functions
      //
      // The alternatives are:
      //
      // - create the literal and then use `[]`.
      // - use `eval`. Bad practice.
      //
      // Good:

        var obj = {a:0}
        var obj = {'a':0}
        var obj = {0:0}

      // `SyntaxError`: missing : after property id.

          //{'a' + 'b':0},
          //{('a' + 'b'):0},

  // #Object.prototype

    // Since literals have this prototype, its methods are shared amongst most objects.

      assert_eq(typeof(Object.prototype), 'object')
      assert_eq(Object.prototype.constructor, Object)

    // Methods of Object.prototype include:

    // #hasOwnProperty

      // Check if an object has a property.

      // Does not look up on prototypes.

        o = {a:0}
        o2 = Object.create(obj)
        o2.b = 1
        assert(!o2.hasOwnProperty('a'))
        assert( o2.hasOwnProperty('b'))

  // #new

      var C = function(x, y) {
        this.x = x
        this.y = y
      }

      C.prototype.sum = function() { return this.x + this.y }

    // This is what `new` does more or less:

      function newObject(func) {
        var args = Array.prototype.slice.call(arguments, 1)
        var object = Object.create(func.prototype)
        func.apply(object, args)
        return object
      }

      var o = newObject(C, 1, 2)
      assert_eq(o.x,     1)
      assert_eq(o.sum(), 3)
      assert_eq(Object.getPrototypeOf(o), C.prototype)
      // TODO where is the constructor set?
      assert_eq(o.constructor, C)
      assert_eq(typeof(o), 'object')
      assert_eq(typeof(C), 'function')

    // Objects are separate:

      var o2 = new C(2, 2)
      assert_eq(o2.x, 2)
      assert_eq(o.x,  1)

    // Same with new:

      var C = function(x, y) {
        this.x = x
        this.y = y
      }

      C.prototype.sum = function() { return this.x + this.y }

      var o = new C(1, 2)
      assert_eq(o.x,     1)
      assert_eq(o.sum(), 3)
      assert_eq(Object.getPrototypeOf(o), C.prototype)
      assert_eq(o.constructor, C)
      assert_eq(typeof(o), 'object')
      assert_eq(typeof(C), 'function')

    // Objects are separate:

      var o2 = new C(2, 2)
      assert_eq(o2.x, 2)
      assert_eq(o.x,  1)

    //#new C vs new C()

      // They are the same: parenthesis an be omitted in this special case
      // where there are no arguments.

        var C = function() {}
        assert_eq((new C).constructor, C)
        assert_eq((new C()).constructor, C)

    //#return value for constructor

      // What the constructor can return:
      // http://stackoverflow.com/questions/1978049/what-values-can-a-constructor-return-to-avoid-returning-this

      // - if it returns an object, new returns the object
      // - else, new returns the constructed object

      // Therefore, returning `this` is the same as not returning anything.

      // 0 is not an object, so the return is ignored:

        var C = function() {
          this.a = 0
          return 0
        }
        assert_eq((new C()).a, 0)

      // If an object is returned, it is used:

        var C = function() {
          this.a = 0
          return {a:1}
        }
        assert_eq((new C()).a, 1)


  // #object oriented patterns #classic object patterns

    // Before going into this, you must understand how dot `.` resolves properties.

    // #instance methods and variables

      // The standard way to write C++ class-like constructs is via functions + new.
      // http://stackoverflow.com/questions/13190097/whats-the-best-way-to-create-javascript-classes?lq=1

        // Constructor.
        var C = function(i) {
          // Instance variable.
          this.i = i

          // Method. BAD: uses more memory as each instance gets one.
          this.geti = function() {
            return this.i
          }
        }

        // Method. GOOD.
        C.prototype.inci = function() {
          this.i += 1
        }

        var c = new C(0)
        var d = new C(10)

        assert_eq(c.i, 0)
        assert_eq(c.geti(), 0)
        c.inci()
        assert_eq(c.geti(), 1)

        assert_eq(d.i, 10)
        assert_eq(d.geti(), 10)
        d.inci()
        assert_eq(d.geti(), 11)

    // #static variables and methods.

      // Two possibilities:

      // - function / constructor properties, probably best.
      // - function prototype properties.

        var C = function() {
          // Best approach.
          this.constructor.staticVariable += 1
          // Worst approach.
          this.constructor.prototype.staticVariableProto += 1
        }
        C.prototype.instanceGetStatic = function() {
          return this.constructor.staticVariable
        }
        C.staticMethod = function() {
          return this.staticVariable
        }
        C.staticVariable = 0
        C.prototype.staticVariableProto = 0

        assert_eq(C.staticVariable, 0)
        assert_eq(C.prototype.staticVariableProto, 0)
        assert_eq(C.staticMethod(), 0)

        c = new C()
        assert_eq(C.staticVariable, 1)
        assert_eq(C.prototype.staticVariableProto, 1)
        assert_eq(C.staticMethod(), 1)

        assert_eq(c.constructor.staticVariable, 1)
        assert_eq(c.staticVariableProto, 1)
        assert_eq(c.instanceGetStatic(), 1)

    // #extend #inheritance

      // TODO

        var d0 = {a:0,  b:1}
        var d1 = {a:10, c:2}
        var d2 = {a:20, d:3}
        //assert_eq(d0.extend(d1, d2), {a:20, b:1, c:2, d:3})

  // #iterate dict #loop dict #for in

    // Only enumerable keys are looped over:

      var obj = {a:0, b:1}
      var keys = []
      for (key in obj) {
        keys.push(key)
      }
      keys.sort()
      assert_eq(keys[0], 'a')
      assert_eq(keys[1], 'b')
      assert_eq(keys.length, 2)

    // #Object.keys

    // Get Array of enumerable property keys:

      var obj = {a:0, b:1}
      var keys = Object.keys(obj)
      keys.sort()
      assert_eq(keys[0], 'a')
      assert_eq(keys[1], 'b')
      assert_eq(keys.length, 2)

  // #delete operator

    // Remove from dict:

      var obj = {0:1}
      assert_eq(Object.keys(obj).length, 1)
      delete obj[0]
      assert_eq(Object.keys(obj).length, 0)

    // On global scope: depends is variable or property of the global object:
    // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/delete#Examples
</script>

  <h3>#callable object</h3>

    <p>Not possible, unless derived from function.</p>

  <h3>#getters</h3>

  <h3>#setters</h3>

  <h3>#__defineGetter__</h3>

  <h3>#__defineSetter__</h3>

    <p>Allow property getting and assignment to do magic user define things.</p>
    <p>In literals with <code>get</code> and <code>set</code>:</p>
    <script>
      var o = {
        a: 7,
        get b() {return this.a + 1;},
        set c(x) {this.a = x / 2}
      }
      assert_eq(o.b, 8)
      o.c = 50
      assert_eq(o.a, 25)
    </script>
    <p>Programmatically with ES5 <code>defineProperty</code></p>
    <p><code>__defineGetter__</code> and <code>__defineSetter__</code> are nonstandard extensions.</p>
    <script>
      var o = {}
      Object.defineProperty(o, 'p', {
        get: function() { return this._p + 1 },
        set: function(x) { this._p = x * 2 }
        // ERROR: too much recursion. TODO workaround without renaming internal property.
        //set: function(x) { this.p = x * 2 }
      })
      o.p = 2
      assert_eq(o.p, 5)
    </script>

<h2>#Set</h2>

  <p>ES6</p>
  <script>
    if (Set) {
      var s = new Set()
      s.add('a')
      s.add('a')
      s.add('b')
      assert_eq(s.size, 2)
      assert(s.has('a'))

      var s = new Set()
      var a = {}
      var b = {}
      var c = {}
      s.add(a)
      s.add(b)
      s.add(b)
      assert_eq(s.size, 2)
      assert(s.has(a))
      assert(s.has(b))
      assert(!s.has(c))
    } else {
      document.write('<p>#Set not present</p>')
    }
  </script>

<h2>#const</h2>

  <p>
    ES6 draft: <a href="http://wiki.ecmascript.org/doku.php?id=harmony:const">http://wiki.ecmascript.org/doku.php?id=harmony:const</a>
  </p>
  <p>Simply prevent update: don't even raise an error.</p>
  <p>Better to also stick to the convention of <code>CAPS_UNDERSCORE</code> for constants.</p>
  <script>
    ;(function () {
      const c = 0
      c = 1
      assert_eq(c, 0)
    }())
  </script>

<script>
// TODO: convert comments on this script to HTML

// #function

  // Return is optional. If no return, `undefined`.

    function maybe_return(b) {
      if (b) {
        return 0
      }
    }

    assert_eq(maybe_return(true),  0)
    assert_eq(maybe_return(false), undefined)

  // #redefine function. ##`function f() vs var f = function()`

    // http://stackoverflow.com/questions/336859/var-functionname-function-vs-function-functionname

    // Without var, hoisting looks for the last definition.

    // Conclusion: never use multiple functions with the same name.

    // Conclusion 2: always use `f = function` so you don't have to worry about conclusion 1.

      function redefine_func() { return 0; }
      function redefine_func() { return 1; }
      assert_eq(redefine_func(),  2)
      function redefine_func() { return 2; }

      var f = function() { return 0; }
      var f = function() { return 1; }
      assert_eq(f(),  1)
      var f = function f() { return 2; }

    // Name is only set for the `function f`, since `f =` creates an anonymous function:

      function f() {}
      assert_eq(f.name,  'f')

      var f = function() {}
      assert_eq(f.name,  '')

  // #default positional arguments

    // Default positional arguments don't exist, but can be emulated using undefined check:

      var f = function(a) {
        if (typeof a === 'undefined') { a = 0; }
        return a + 1
      }
      assert_eq(f(),  1)
      assert_eq(f(1), 2)

    // CoffeScript allows us to write `f: (a = 0) ->`.

  //TODO named arguments?

  // #call

    // Call a function.

    // Allows to change the value of this via the first parameter.

      var f = function(x, y) { return this.x + x + y + 1; }
      assert_eq(f.call({x: 100}, 0, 10), 111)

    // Use cases for explicit call: http://stackoverflow.com/questions/9001830/the-reason-to-use-js-call-method

  // #apply

    // vs call: http://stackoverflow.com/questions/1986896/what-is-the-difference-between-call-and-apply

    // Main difference: takes array of arguments:

      var f = function(x, y) { return this.x + x + y + 1; }
      assert_eq(f.apply({x: 100}, [0, 10]), 111)

  // It is possible to assign functions to variables:

    var f = function() {
      return 1
    }
    var vf = f
    assert_eq(vf(), 1)

  // Call before definition #hoisting

    // Unlike variables, functions can be defined after usage.

    // At call functions are searched for forwards.

    // This is called hoisting.

    // Hoisting only works within a single script tag, not across them.

      assert_eq(to_be_defined(), 1)
      function to_be_defined() {
        return 1
      }

    // The lookahead only works for `function` statements.

    // It does not work for function expressions in anonymous functions for example:

      //assert_eq(to_be_defined_anon(), 1) //ERROR
      var to_be_defined_anon = function() {
        return 1
      }

  // #pass by reference #pass by value

    // http://stackoverflow.com/questions/518000/is-javascript-a-pass-by-reference-or-pass-by-value-language

    // Like Python:

  // #var

    // Create a new variable in current scope instead of using those variables
    // as part of a closure if they exist outside.

    // It is a good practice to always use var, unless you explicitly expect the variable
    // to refer to something on the outer scope.

      var incr_var = function() {
        var i, j
        i += 1
        j += 1
      }

      var incr_novar = function() {
        i += 1
        j += 1
      }

      i = 0
      j = 10
      incr_var()
      assert_eq(i, 0)
      assert_eq(j, 10)

      i = 0
      j = 10
      incr_novar()
      assert_eq(i, 1)
      assert_eq(j, 11)

    // The var statement sets variables to `undefined` instead of generating syntax errors.

      ;(function() {
        var a
        assert_eq(a, undefined)
      })()

    // Its saner to use `var` as the very first thing inside functions,
    // but it does not matter: `var` statements are hoisted.

      var a = 0
      ;(function() {
        assert_eq(a, undefined)
        if (false) {
          var a
        }
      })()

    // On the global scope,
    //
    // - variables defined without `var` are properties of the global object
    // - those defined with var are new variables
    //
    // This difference in behavior can be observed, for example via `delete`.

      //x = 42;         // creates the property x on the global object
      //var y = 43;     // declares a new variable, y

  // #arguments

    // Any number of arguments can be passed to a function.

    // If less arguments are passed on the call than on the definition, missing args are `undefined`.

    // The `arguments` variable can be used to access any of the passed arguments.

      var f = function(a, b) {
        assert_eq(arguments[0], a)
        assert_eq(arguments[1], b)
        return {a:a, b:b, c:arguments[2]}
      }
      assert_eq(f(0).a,       0)
      assert_eq(f(0).b,       undefined)
      assert_eq(f(0).c,       undefined)
      assert_eq(f(0, 1).a,    0)
      assert_eq(f(0, 1).b,    1)
      assert_eq(f(0, 1).c,    undefined)
      assert_eq(f(0, 1, 2).a, 0)
      assert_eq(f(0, 1, 2).b, 1)
      assert_eq(f(0, 1, 2).c, 2)

  // #splat

    // No convenient built-in support before ES6, probably direct support on ES6:
    // <http://stackoverflow.com/questions/17380315/splat-operators-in-javascript-equivalent-to-args-and-kwargs-in-python>

    // before ES6

      // You can use `arguments` + `call`.

      // `arguments` is an Array-like object: it is **not** an actual Array.
      // It only contains the following properties:

      // - callee.
      // - caller. Obsolete.
      // - length.

        var f = function() {
          assert_eq(arguments.length, 2)
          // TODO
          //assert_eq(arguments.callee, this)
        }
        f(0, 1)

      // To convert `arguments` to an Array use the following idiom:

        var f = function() {
          return Array.prototype.slice.call(arguments, 0).sort()
        }
        assert_eq(f(1, 0)[0], 0)

    // Coffescript

      // Supports splats, probably by wrapping the pre-ES6 idiom.

  // #this

    // Great article: <http://yehudakatz.com/2011/08/11/understanding-javascript-function-invocation-and-this/>

    // This is fixed by the function that calls it at call time:
    // it is therefore the work of the dot `.` operator.
    // Nothing is determined at definition time (`new` operator).

    // ES5 says there is a primitive `[[Call]]` that both `func.call` and `[obj.]func()` call.

    // This primitive looks very much like `call`, so for most purposes you can think they are the same.

    // Before reading this learn about `call`.

    // The following possibilities exist:

      // function call:       this value
      //`f()`:                `window`
      //`'use strict'; f()`:  `undefined`
      //`'obj.obj2.f()`:      `obj.obj2`

    // #this in global functions

        var f = function() { return this }
        assert_eq(f(), window)

      // `f()` gets converted into something like:

        assert_eq(f.call(window), window)

      // With strict, Katz says:
      //
      // > The ECMAScript 5 spec says that undefined is (almost) always passed,
      // > but that the function being called should change its thisValue
      // > to the global object when not in strict mode.
      // > This allows strict mode callers to avoid breaking existing non-strict-mode libraries.
      //
      // I don't know what that means.

        ;(function() {
          'use strict'
          ;(function() {
            // TODO why no undefined?
            //assert_eq(f(), undefined)
            assert_eq(f(), window)
          })()
          assert_eq(f(), window)
        })()

    // #this in methods

      // The method has no information about what called it:
      // all information is passed at call time.

        var obj = {}
        obj.f = function() {
          return this
        }

        assert_eq(obj.f(), obj)

      // Gets converted to:

        assert_eq(f.call(obj), obj)

      // And:

        g = obj.f
        assert_eq(g(), window)

      // Gets converted to:

        assert_eq(g.call(window), window)

      // The same happens in constructs like:

        var F = function() { this.x = 0 }
        var f = new F()

      // but you have to open up the definition of `new`, and you will see that
      // `F` is being called with `this` equal to `f` (what it returns).

      // #this and callback in class oriented patterns

        // This reassignment is specially hurting for callbacks inside class oriented patterns,
        // and Js uses callbacks *a lot*.

          var takeCallback = function(cb) {
            return cb()
          }
          var C = function() {
            this.instanceVariable = 0
          }
          C.prototype.instanceMethodFail = function() {
            return takeCallback(function() {
              // AHA! Although this is inside an instance method,
              // it is also inside a callback, and `this` will be overwritten when called!
              return this.instanceVariable
            })
          }
          var c = new C
          assert_eq(c.instanceMethodFail(), undefined)

        // Solution: bind techniques.

      // #bind

        // We often want to "bind" the method to "its" object.

        // This has led to:

        // - a common design pattern with closures:

            var bind = function(func, thisValue) {
              return function() {
                return func.apply(thisValue, arguments)
              }
            }
            obj = {}
            obj.f = function() { return this }
            var boundF = bind(obj.f, obj)
            assert_eq(boundF(), obj)

        // - an ES5 language feature, `bind` method for functions:

            obj = {}
            obj.f = function() { return this }
            var boundF = obj.f.bind(obj)
            assert_eq(boundF(), obj)

        // CoffeScript has a dedicated language feature to make binding super easy:
        // fat arrow `=>` function definitions.

    //#this and jQuery

      // jQuery automatically sets `this` to useful things: its not default ES5 behavior.

      // In particular, callbacks have `this` set to the object that generated the event.

    // #this on global scope

      // TODO what happens? In Firefox and Chrome `this` is the `window` object:

        assert_eq(this, window)

        var f = function() {
          assert_eq(this, window)
        }
        f()


  // #closure

    // Function + variables taken from its context.

    // http://stackoverflow.com/questions/111102/how-do-javascript-closures-work

    // Whenever a `var x` or function argument is visible to a function definition,
    // the definition takes those variables in its closure.

    // add1 and add2 are closures. The value of x is part of the closure.

      var makeAdder = function(x) {
        return function(y) {
          return x + y
        }
      }
      var add1 = makeAdder(1)
      var add2 = makeAdder(2)
      assert_eq(add1(3), 4)
      assert_eq(add2(3), 5)

    // The closure can modify its variable.

      var makeIncrementer = function() {
        var x = 0
        return function() {
          x++
          return x
        }
      }
      var incrementer1 = makeIncrementer()
      var incrementer2 = makeIncrementer()
      assert_eq(incrementer1(), 1)
      assert_eq(incrementer1(), 2)
      // Each closure has a different version of the variable.
      assert_eq(incrementer2(), 1)
      assert_eq(incrementer2(), 2)

    // Every function is a closure, but for functions defined outside functions it is not possible to notice it.

    // The variable in the closure and the corresponding one outside are exactly the same.

    ;(function(){
      var x = 0
      var f = function() {
        return x
      }
      x = 1
      assert_eq(f(), 1)
    }())

  // #anonymous function

    var f = function() {return 1}
    assert_eq(f(), 1)

    // #IIFE #immediately invoking function expression #self executing anonymous function

      // Amazing tutorial: http://benalman.com/news/2010/11/immediately-invoked-function-expression/

      // Defined the function and call itself immediately:

        assert_eq((function(x) {return x + 1}(1)), 2)
        assert_eq((function(x) {return x + 1})(1), 2)

      // Both the above are the same:
      // http://stackoverflow.com/questions/3384504/location-of-parenthesis-for-auto-executing-anonymous-javascript-functions

      // Syntax error without parenthesis:

        //function(x) {return x + 1}(1)

      // because:

      // - `function` keyword in the global scope or inside a function -> function declaration (statement)
      //     https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/function
      //     SyntaxError because function declarations require a name
      // - inside parenthesise, function expression, because there can be no statements inside parenthesis.
      //     https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/function

      // Name and empty parenthesis also implies a different `SyntaxError`:

        //function foo() {}()

      // Which is he same as:

        //function foo() {};
        //();

      // And `()` is a syntax error, unlike:

        var a = 0
        function foo() { a = 1 }(1)
        assert_eq(a, 0)

      // Which is not a syntax error, but does not execute the function either.

      // There are other less readable ways to coerce the statement to a function expression:

        var a = 0
        a = function() { return 1 }()
        assert_eq(a, 1)

      // Or if you don't care about the return value:

        !function() {}()

      // Major application: create a new scope so as not to affect variables outside.

        var a = {x:1}
        var b = {x:2}
        ;(function(a) {
          var global_undefined = 0
          assert_eq(a.x, 1)
          a.x = -1
          b.x = -2
        })(a)
        assert_eq(a.x, -1)
        assert_eq(b.x, -2)

        assert_throws(
          function() { global_undefined },
          ReferenceError
        )

      // This specially useful if you have a closure callback:

        //;(function() {
        //  var elem = getTheElement()
        //  document.body.addEventListener(
        //    'load',
        //    function() {
        //      // Do something with elem.
        //      //
        //      // Could use getTheElement() again, but would be less efficient
        //      // because of the extra search per callback call.
        //      //
        //      // Without the IIFE, elem could be redefined afterwards,
        //      // which would affect this closure.
        //    },
        //    false
        //  )
        //}())

    // #Named IIFE

      // You can also give a name to an IIFE function, although this is not very useful,
      // as it can only be accessed from inside the function itself.

        assert_eq((function f(x) {return x + 1}(1)), 2)

    // #Module pattern

      // Use IIFE + closures to create objects with private members.

      // Prototype vs closure based techniques:
      // http://stackoverflow.com/questions/3564238/object-oriented-javascript-with-prototypes-vs-closures

        var counter = (function() {
          var i = 0
          return {
            get: function() {
              return i
            },
            set: function(val) {
              i = val
            },
            increment: function() {
              return ++i
            }
          }
        }());
        assert_eq(counter.get(), 0)
        counter.set(3)
        assert_eq(counter.increment(), 4)
        assert_eq(counter.increment(), 5)
        assert_eq(counter.i, undefined)

// #= #assignment operator

  // Variables contain address of data.
  // `=` always takes the address of the data on the right and sets it to the variable on the left.
  // Integers like `0` and `1` *do* have a single (because immutable) address in JavaScript.

    var a = 0
    var b = a
    b = 1
    assert_eq(a, 0)

    var a = [0]
    var b = a
    b[0] = 1
    assert_eq(a[0], 1)

    var a = [[0]]
    var b = a
    b[0][0] = 1
    assert_eq(a[0][0], 1)

// #array #[]

    var a = [0, 'a']
    assert_eq(a.length, 2)
    assert_eq(a[0], 0)
    assert_eq(a[1], 'a')

  // Access last element: just do `a[a.length - 1]`
  // http://stackoverflow.com/questions/3216013/get-the-last-item-in-an-array

  //#Arrays are hash objects

    // http://stackoverflow.com/questions/6445010/what-is-a-javascript-array
    //
    // Arrays are *not*:
    //
    // - contiguous chunks of data like in C
    //     They could never be contiguous because their objects can have different sizes.
    //
    // - lists like in Python and Ruby, in which doing `a = [0, 1]; a[3] = 2` is an error.
    //
    // Length is updated whenever a key that is an integer is set and larger than current length.
    //
    // This makes length behave like an intuitive array.
    //
    // This allows us to do:

      var a = [1, 0]
      //{0:1, 1:0, length:2}
      a[9] = 2
      //{0:1, 1:0, 9:2}
      assert_eq(a[9], 2)
      assert_eq(a.length, 10)

    // The above does *not* occupy 10 memory slots: only one more.

    // If the new key is not an integer length is not updated:

      a['b'] = 3
      assert_eq(a.b, 3)
      assert_eq(a.length, 10)

  // Like any other non primitive objects:

    assert_neq([], [])

  // There is no short built-in way of comparing them: http://stackoverflow.com/questions/7837456/comparing-two-arrays-in-javascript

  // A good library based workaround is Uderscore.js's isEqual.

  //#Array explicit constructor

    // `new Array` vs `Array`: unlike `new String` vs `String`, they are identical
    // http://stackoverflow.com/questions/8205691/coffeescript-array-vs-new-array

    // `String()` vs `''`: http://stackoverflow.com/questions/931872/whats-the-difference-between-array-and-while-declaring-a-javascript-ar

    // Generates identical objects:

      assert_eq([].constructor,            Array)
      assert_eq(Array().constructor,       Array)
      assert_eq((new Array()).constructor, Array)

    // With a single element, explicit constructor allocates a pre filled array,
    // which is more efficient than adding elements one by one.
    // The contents are unspecified.

      assert_eq(new Array(3).length, 3)
      assert_eq(new Array(3)[0], undefined)

    // As any other function, `Array` can be redefined by an evil script:

      //(function(){
      //  var Array = 1
      //  assert_eq(Array, 1)
      //}())

  // #push #append

    var a = [0, 1]
    a.push(2)
    assert_eq(a[2], 2)

  // #indexOf

    // Get index of element in array. If not present returns -1.

    // ES5. For greater backwards compatibility people still use jQuery `inArray` version.

      assert_eq([2, 0, 1].indexOf(0), 1)
      assert_eq([2, 0, 1].indexOf(3), -1)

  // #slice

      var a = [2, 0, 1].slice(1)
      assert_eq(a[0], 0)
      assert_eq(a[1], 1)
      assert_eq(a.length, 2)

      var a = [2, 0, 1, 3].slice(1, 3)
      assert_eq(a[0], 0)
      assert_eq(a[1], 1)
      assert_eq(a.length, 2)

  // #iterate #forEach

    // for in iterates all properties of an object, so it does *not* work!

    // Use either explicit index or forEach method for arrays.

      var a = [0, 1, 2]
      var total = 0
      for (var i = 0; i < a.length; i++) {
        total += a[i]
      }
      assert_eq(total, 3)

    // forEach is ES5:

      var a = [0, 1, 2]
      var total = 0
      a.forEach(function(x) {
        total += x
      })
      assert_eq(total, 3)


  // #sort

    // In place:

      var a = [1, 2, 0]
      a.sort()

// #exception #try #catch #finally

  // try catch finally

  // No `else`, use a variable instead:
  // http://stackoverflow.com/questions/4872170/javascript-try-catch-else-finally-like-python-java-ruby-etc

    var a = 0
    try {
      throw 0
    } catch (err) {
      assert_eq(err, 0)
    } finally {
      a = 1
    }
    assert_eq(a, 1)

  //#Error

    // Anything can be thrown, but the Error is a good ES base class to throw,
    // as it shows a stack trace it it explodes, while things like strings don't.

      //new Error()

</script>

<h2>#Date</h2>

  <p>
    <b>Gotcha</b>: <code>month</code> is 0-based,
    e.g. <code>1</code> means February!
  </p>

  <p>Explicit constructor and getters for <i>local</i> time:</p>
  <script>
    var date = new Date(2000, 1, 2, 3, 4, 5, 6)
    assert_eq(date.getFullYear()    , 2000)
    assert_eq(date.getMonth()       , 1)
    assert_eq(date.getDate()        , 2) // Day of the month.
    assert_eq(date.getHours()       , 3)
    assert_eq(date.getMinutes()     , 4)
    assert_eq(date.getSeconds()     , 5)
    assert_eq(date.getMilliseconds(), 6)
  </script>

  <p>Other constructors:</p>
  <script>
    new Date(1) //milliseconds since 1970/01/01
    new Date('2000-02-02T02:04:05.006Z')
  </script>

  <p>
    Create a UTC date object with <code>new Date(Date.UTC(2000, 1, 2, 3, 4, 5, 6))</code>.
    Works because <code>Date.UTC</code> returns the number of milliseconds in UTC.
  </p>
  <p>
    <code>toISOString</code>, ES5,
    ISO 8601 <a href="http://en.wikipedia.org/wiki/ISO_8601">http://en.wikipedia.org/wiki/ISO_8601</a>
    By default ends in <code>Z</code>, thus it is the UTC time, not local time!
  </p>
  <script>
    assert_eq((new Date(Date.UTC(2000, 1, 2, 3, 4, 5, 6))).toISOString(), '2000-02-02T03:04:05.006Z')
  </script>
  <script>
    document.write('<p>Current UTC datetime: ' + (new Date()).toISOString() + '</p>')
  </script>

<h2>#JSON</h2>

  <p>ES5, thus also present in Node.js.</p>
  <p>
    For greater portability,
    <a href="https://github.com/douglascrockford/JSON-js/blob/master/json2.js">https://github.com/douglascrockford/JSON-js/blob/master/json2.js</a>
    is a common option through the CDN:
    <a href="http://ajax.cdnjs.com/ajax/libs/json2/20110223/json2.js">http://ajax.cdnjs.com/ajax/libs/json2/20110223/json2.js</a>
  </p>
  <script>
    var json = '{"a":1, "b":"c"}'
    var obj = JSON.parse(json)
    assert_eq(obj.a, 1)
    assert_eq(obj.b, 'c')
  </script>

<h2>#eval</h2>

  <p>Run code from string in current environment.</p>
  <script>
    var a = 0
    eval('a = 1')
    eval('var b = 2')
    assert_eq(a, 1)
    assert_eq(b, 2)
  </script>

<h2>#promise</h2>

  <p>ES6, already implemented in some browsers.</p>
  <p>Makes it easier to deal with event success / failure.</p>
  <p>Good article: <a href="http://www.html5rocks.com/en/tutorials/es6/promises/">http://www.html5rocks.com/en/tutorials/es6/promises/</a></p>
  <p>Already implemented by many libraries.</p>
  <p>
    Promises/A+ is an open standard that influences ES6.
    It is followed by the promise implementation of some libraries, but not others,
    notably jQuery.
  </p>
  <p>
    In jQuery, `Promise` is a subset of `Deferreds`.
  </p>
  <p>
    The following implementation exists for Node.js that mimics EC6's exactly:
    <a href="https://github.com/jakearchibald/es6-promise">https://github.com/jakearchibald/es6-promise</a>
  </p>

<h2>#window</h2>

  <p>
    Documented on the HTML5 browsers section:
    <a href="http://www.w3.org/TR/html5/browsers.html#the-window-object">http://www.w3.org/TR/html5/browsers.html#the-window-object</a>
  </p>
  <p>One of the most important objects.</p>
  <p>Offers an interface to the browser contents.</p>
  <p>May be undefined on Node.js. This can be used to check if we are no Node.js or browser.</p>
  <p>`window` is the global object in browser implementations: http://www.ecma-international.org/ecma-262/5.1/#sec-15.1</p>
  <p>It is not present in Node.js.</p>
  <p>All global objects are attributes of window</p>
  <script>
    a = 1
    window.a = 2
    assert_eq(a, 2)
    this.a = 3
    assert_eq(a, 3)
  </script>

  <h3>#modal</h3>

  <h3>#dialog</h3>

    <p>In-window modals (popup that disables background).</p>
    <p>
      Practical, but not very customizable, cannot render HTML in it.
      Whitespace is preserved.
    </p>
    <p>
      Often replaced by more flexible JavaScript libraries or CSS <code>:target</code>.
      Bootstrap offers:
      <a href="http://getbootstrap.com/javascript/#modals">http://getbootstrap.com/javascript/#modals</a>
    </p>
    <p>The following built-in modals exist:</p>

    <h4>#alert</h4>

      <p>
        Show an important message. Only a single continue button exists,
        so no information can be retrieved from the user.
      </p>
      <button onclick="window.alert('Alert. Newline:\nafter.' +
          ' Many   spaces.\n<b>not bold</b>')" type="button">Open popup</button>

    <h4>#confirm</h4>

      <p>
        Get a boolean value from the user. Common for: "are you sure you want to quit?"
        messages to avoid data loss while editing potentially large textareas.
      </p>
      <button onclick="window.alert('You said: ' + window.confirm('Yes or no?'))" type="button">Open popup</button>

    <h4>#prompt</h4>

      <p>
        Get a string value from the user.
        Very rare because it does not scale well: it is only a matter of time before you need another field.
        Also makes the site unusable if Js is off. Use HTML forms instead.
      </p>
      <button onclick="window.alert('You said: ' + window.prompt('Enter a string.', 'Default value.'))" type="button">Open popup</button>

  <h3>#height</h3>

  <h3>#width</h3>

  <h3>#innerHeight</h3>

  <h3>#outerHeight</h3>

    <p>Not on IE8.</p>

    <p>Inner does not include scrollbars, toolbars, address bar, tabs:</p>
    <div><code>window.innerHeight</code> = </div>
    <script>previousElement().insertAdjacentHTML('beforeEnd', window.innerHeight)</script>
    <div><code>window.innerWidth</code>  = </div>
    <script>previousElement().insertAdjacentHTML('beforeEnd', window.innerWidth)</script>

    <p>Outer includes everything:</p>
    <div><code>window.outerHeight</code> = </div>
    <script>previousElement().insertAdjacentHTML('beforeEnd', window.outerHeight)</script>
    <div><code>window.outerWidth</code> = </div>
    <script>previousElement().insertAdjacentHTML('beforeEnd', window.outerWidth)</script>

  <h3>#scroll</h3>

  <h3>#pageXOffset</h3>

  <h3>#pageYOffset</h3>

  <h3>#scrollBy</h3>

    <p>Get how much scroll was done from top left:</p>
    <div>window.pageXOffset = </div>
    <script>previousElement().insertAdjacentHTML('beforeEnd', window.pageXOffset)</script>
    <div>window.pageYOffset = </div>
    <script>previousElement().insertAdjacentHTML('beforeEnd', window.pageYOffset)</script>
    <p>scrollby: TODO window.scrollBy(100,100)</p>

  <h3>#setInterval</h3>

  <h3>#clearInterval</h3>

    <p>Run a function every n milliseconds.</p>
    <p>
      500ms:
      <span id="setInterval">0</span>
      <button id="clearInterval" type="button">Stop.</button>
    </p>
    <script>
      var setIntervalCount = 0
      var interval0 = window.setInterval(function() {
        setIntervalCount++
        document.getElementById('setInterval').innerHTML = setIntervalCount.toString()
      }, 500)
      document.getElementById('clearInterval').addEventListener(
        'click',
        function(even) {
          window.clearInterval(interval0)
          even.target.insertAdjacentHTML('beforeEnd', ' Stopped.')
        },
        true
      )
    </script>

  <h3>#setTimeout</h3>

  <h3>#sleep</h3>

    <p>Callback once after given number of milliseconds.</p>
    <p>Not part of ES5, but Node.js also implements an identical interface.</p>
    <button type="button">
      Click me. Something will happen in 1 second.
    </button>
    <script>
      previousElement().addEventListener(
        'click',
        function() {
          window.setTimeout(
            function() {
              alert('You clicked me 1 second ago.')
            },
            1000
          )
        },
        false
      )
    </script>

    <p>Asynchronous:</p>
    <script>
      (function() {
        var x = 0
        window.setTimeout(
          function() {
            assert_eq(x, 1)
          },
          1000
        )
        x = 1
      }())
    </script>

  <h3>#open</h3>

    <p>Opens up new windows / tabs on the browser.</p>
    <p>Popup blockers usually block this.</p>
    <p>Good way to annoy users =)</p>
    <p>Returns a window object.</p>
    <button>Click me to run window.open.</button>
    <script>
      previousElement().addEventListener(
        'click',
        function() {
          var myWindow = window.open('', 'name', 'width=200, height=100');
        },
        false
      )
    </script>
    <p>TODO: what is the <code>name</code> parameter?</p>

  <h3>#location</h3>

    <p>
      <a href="http://www.w3.org/TR/html5/browsers.html#location">http://www.w3.org/TR/html5/browsers.html#location</a>
    </p>
    <p>
      Implements
      <a href="http://www.w3.org/TR/html5/infrastructure.html#urlutils">http://www.w3.org/TR/html5/infrastructure.html#urlutils</a>
      which contains many properties like <code>href</code> and <code>hash</code>.
      <code>urlutils</code> seems to be defined at:
      <a href="https://url.spec.whatwg.org/#urlutils">https://url.spec.whatwg.org/#urlutils</a>
    </p>

    <h4>#reload</h4>

      <p>Reload current page page: <code>window.location.reload()</code>.</p>
      <p><button onclick="window.location.reload()" type="button">Reload this page!</button></p>
      <script>
        document.write('<p>Last page load time: ' + (new Date()).toISOString() + '</p>')
      </script>

    <h4>#assign</h4>

      <p>Set URL and navigate to it. Old URL gets added to history.</p>

    <h4>#replace</h4>

      <p>Same as <code>assign</code> but old URL does not get added to history.</p>

    <h4>#href</h4>

    <h4>#redirect</h4>

      <p>For assignment, same as: <code>window.location.assign('url')</code>.</p>
      <p><button onclick="window.location.href='html2.html'" type="button">Redirect to html2.html!</button></p>

    <h4>#Get current URL</h4>

    <h4>#document.URL</h4>

      <p><a href="http://stackoverflow.com/questions/1034621/get-current-url-with-javascript">http://stackoverflow.com/questions/1034621/get-current-url-with-javascript</a></p>

      <p>
        <code>document.URL</code>: readonly from when page was loaded
        (not affected by JavaScript operations like <code>replace</code>)
      </p>

      <p>
        <code>window.location.href</code>: updated by JavaScript operations.
      </p>

    <h4>#hash</h4>

      <p>Same as: <code>window.location.assign('#fragment')</code>.</p>

      <ul>
        <li>page height jumps leaving the target ID at the top</li>
        <li>the URL is changed</li>
      </ul>

      <p><button onclick="window.location.hash='location-hash'" type="button">Go to <code>#location-hash</code>.</button></p>

      <p id="location-hash">My id is <code>location-hash</code>.</p>

  <h3>#history</h3>

    <p>HTML5</p>

    <p><a href="https://developer.mozilla.org/en-US/docs/Web/Guide/API/DOM/Manipulating_the_browser_history">https://developer.mozilla.org/en-US/docs/Web/Guide/API/DOM/Manipulating_the_browser_history</a></p>

    <p>Do not trigger <code>DOMContentLoaded</code>.</p>

    <p>
      Still not consistent across browsers. A popular alternative is the History.js library
      <a href="https://github.com/browserstate/history.js">https://github.com/browserstate/history.js</a>
      which provides the <code>History</code> object and a similar property interface to that of the standard.
    </p>

    <p>
      Apparently you can only get the last one for security reasons:
      <a href="http://stackoverflow.com/questions/3528324/how-do-you-get-the-previous-url-in-javascript">http://stackoverflow.com/questions/3528324/how-do-you-get-the-previous-url-in-javascript</a>
    </p>

    <h4>#Modify current URL without reloading the page</h4>

      <p><a href="http://stackoverflow.com/a/3503206/895245">http://stackoverflow.com/a/3503206/895245</a></p>

      <p>Great to store state while making AJAX or preloaded modifications.</p>

      <p>User can still go back to previous URLs because this history is being modified.</p>

      <p>
        May not work on <code>file:///</code> for security concerns.
        Try on <code>localhost</code> with <code>python -m SimpleHTTPServer</code>
      </p>

      <p>
        <span class="border" onclick="window.history.pushState('page1', 'Title1', '/new-url-1');">click me for new-url-1!</span>
        <span class="border" onclick="window.history.pushState('page2', 'Title2', '/new-url-2');">click me for new-url-2!</span>
      </p>

  <h3>#non-standard attributes</h3>

    <h4>#console</h4>

      <p><a href="http://stackoverflow.com/questions/4539253/what-is-console-log">http://stackoverflow.com/questions/4539253/what-is-console-log</a></p>
      <p>Widely implemented (but not necessarily uniformly).</p>
      <p>On Firefox, logged messages appear under Console &gt; Logging </p>

    <h4>#navigator</h4>

      <p>Navigator metadata</p>

    <h4>#resizeTo</h4>

      <p>Change the window size of the browser.</p>
      <p>Chrome and IE WONTFIX, so unlikely to end up in a spec.</p>
      <p><a href="http://stackoverflow.com/questions/7452040/cross-browser-resize-browser-window-in-javascript">http://stackoverflow.com/questions/7452040/cross-browser-resize-browser-window-in-javascript</a></p>

    <h4>#moveTo</h4>

      <p>Move browser window to position on screen. Same status as <code>resizeTo</code>.</p>

    <h4>#fullscreen</h4>

      <p><a href="http://stackoverflow.com/questions/1125084/how-to-make-in-javascript-full-screen-windows-stretching-all-over-the-screen">http://stackoverflow.com/questions/1125084/how-to-make-in-javascript-full-screen-windows-stretching-all-over-the-screen</a></p>
      <p>
        Starting to get a specification at:
        <a href="http://fullscreen.spec.whatwg.org/">http://fullscreen.spec.whatwg.org/</a>,
        but still very early stage. Already has incompatible implementations on major browsers.
        Most implementations first asks user if he wants to do it the first time.
      </p>

    <h4>#pointer lock</h4>

      <p><a href="https://dvcs.w3.org/hg/pointerlock/raw-file/default/index.html">https://dvcs.w3.org/hg/pointerlock/raw-file/default/index.html</a></p>
      <p><a href="http://www.html5rocks.com/en/tutorials/pointerlock/intro/">http://www.html5rocks.com/en/tutorials/pointerlock/intro/</a></p>
      <p>
        Locks the pointer into the screen.
        Allows for similar effect to common first person shooters.
      </p>
      <p>Still in very early stage as of 2014.</p>

  <h3>#document</h3>

    <p>
      HTML5:
      <a href="http://www.w3.org/TR/html5/dom.html#document">http://www.w3.org/TR/html5/dom.html#document</a>
      which extends the DOM specification:
      <a href="http://www.w3.org/TR/dom/#document">http://www.w3.org/TR/dom/#document</a>
    </p>
    <p>This section shall only describe the HTML5 extensions.</p>

    <h4>#HTMLDocument</h4>

      <p>Constructor of the <code>window.document</code> object.</p>

      <script>
        assert_eq(document.constructor, HTMLDocument)
      </script>

    <h4>#write</h4>

      <p>Write after the current script.</p>
      <script>
        document.write('<p>written by document write</p>')
      </script>
      <p>
        Scripts inserted like this will be executed.
        TODO which order?
        <a href="http://stackoverflow.com/questions/94141/javascripts-document-write-inline-script-execution-order">http://stackoverflow.com/questions/94141/javascripts-document-write-inline-script-execution-order</a>
        Probably not a good idea to rely on such things.
      </p>
      <script>
        var a = 0
        document.write('<script>a = 1</scr'+'ipt>')
        // TODO deterministic? Firefox and Chromium tests have passed.
        //assert_eq(a, 1)
      </script>
      <script>
        // TODO deterministic? Firefox and Chromium tests have passed.
        //assert_eq(a, 1)
      </script>

    <h4>#referrer</h4>

      <p>Last URL before current, if use clicked on a link to come here.</p>

      <p>
        May not always work?
        <a href="http://stackoverflow.com/questions/3528324/how-do-you-get-the-previous-url-in-javascript">http://stackoverflow.com/questions/3528324/how-do-you-get-the-previous-url-in-javascript</a>
      </p>

      <div><code>document.referrer</code> = </div>
      <script>previousElement().insertAdjacentHTML('beforeEnd', document.referrer)</script>

      <p>See also: <code>window.history</code></p>

    <h4>#domain</h4>

      <p>
        <a href="http://www.w3.org/TR/html5/browsers.html#dom-document-domain">http://www.w3.org/TR/html5/browsers.html#dom-document-domain</a>
      </p>
      <p>Can always be read, and set with some SOP limitations.</p>

      <div></div>
      <script>previousElement().insertAdjacentHTML('beforeEnd', document.referrer)</script>

<h2>#DOM</h2>

  <p>Interface to interact with both HTML and XML elements from a tree point of view.</p>

  <h3>Standards</h3>

    <p>All HTML5 elements have a "DOM Interface IDL" section which specifies its available properties.</p>
    <p>List of all DOM specs: <a href="http://www.w3.org/DOM/DOMTR">http://www.w3.org/DOM/DOMTR</a></p>
    <p>Edge spec: <a href="http://www.w3.org/TR/dom/">http://www.w3.org/TR/dom/</a></p>
    <p>The entire DOM spec is split across multiple modules. Latest REC is DOM level 3.</p>
    <ul>
      <li>core: <a href="http://www.w3.org/TR/2004/REC-DOM-Level-3-Core-20040407/">Core</a></li>
      <li>events: <a href="http://www.w3.org/TR/2000/REC-DOM-Level-2-Events-20001113/">Level 2 Events REC</a>.</li>
    </ul>

    <h4>#DOM0</h4>

      <p>Informal name for pre W3C standard rules, specially those derived from Netscape behavior.</p>
      <p>
        Some still work widely across browsers, but have been superseded by a W3C standard method,
        for instance returning <code>false</code> from <code>click</code> vs <code>preventDefault</code>.
      </p>

  <h3>#Node object</h3>

    <p><a href="http://www.w3.org/TR/dom/#node">http://www.w3.org/TR/dom/#node</a></p>
    <p>
      Different from <code>Element</code>, which is a child class.
    </p>

  <h3>#NodeList</h3>

  <h3>#HTMLCollection</h3>

    <p><a href="http://www.w3.org/TR/dom/#nodelist">http://www.w3.org/TR/dom/#nodelist</a></p>
    <p>
      Many DOM methods that get multiple nodes like <code>getElementsByClassName</code> do not return
      an <code>Array</code> but <code>NodeList</code> or <code>HTMLCollection</code> objects.
      Those are Array-like and support index access, but not all Array operations such as <code>forEach</code>.
    </p>
    <p>
      To use arbitrary <code>Array</code> methods, first convert to an array with
      <code>Array.prototype.slice.call(elem.getElementsByClassName('class'))</code>
    </p>

  <h3>#nodeType</h3>

    <p>
      Apparently some node types have been deprecated:
      <a href="https://developer.mozilla.org/en-US/docs/Web/API/Node.nodeType">https://developer.mozilla.org/en-US/docs/Web/API/Node.nodeType</a>
    </p>

    <ul>
      <li>1 : <code>ELEMENT_NODE</code></li>
      <li>2 : <code>ATTRIBUTE_NODE</code></li>
      <li>3 : <code>TEXT_NODE</code></li>
      <li>4 : <code>CDATA_SECTION_NODE</code></li>
      <li>5 : <code>ENTITY_REFERENCE_NODE</code></li>
      <li>6 : <code>ENTITY_NODE</code></li>
      <li>7 : <code>PROCESSING_INSTRUCTION_NODE</code></li>
      <li>8 : <code>COMMENT_NODE</code></li>
      <li>9 : <code>DOCUMENT_NODE</code></li>
      <li>10: <code>DOCUMENT_TYPE_NODE</code></li>
      <li>11: <code>DOCUMENT_FRAGMENT_NODE</code></li>
      <li>12: <code>NOTATION_NODE</code></li>
    </ul>

    <h4>#nodeName</h4>

      <p>A string representing the <code>nodeType</code></p>

    <h4>#tagName</h4>

      <p>Only meant for nodes of type 1, AKA elements.</p>

    <h4>Examples</h4>

      <div class="a">a</div>
      <script>
        var e = previousElement()

        node = e
        assert_eq(node.nodeType, 1)
        assert_eq(node.nodeName, 'DIV')
        assert_eq(node.tagName, 'DIV')

        node = e.getAttributeNode('class')
        assert_eq(node.nodeType, 2)
        assert_eq(node.nodeName, 'class')
        assert_eq(node.tagName, undefined)

        node = e.childNodes[0]
        assert_eq(node.nodeType, 3)
        assert_eq(node.nodeName, '#text')
        assert_eq(node.tagName, undefined)
      </script>

  <h3>#nodeValue</h3>

  <h3>#innerHTML</h3>

    <p>
      *Don't* do <code>innerHTML += innerHTML + 'something'</code> unless you are sure it is only a string.
      Otherwise, this would destroy events associated to elements in the <code>innerHTML</code>.
      Use <code>insertAdjacentHTML</code> instead.
    </p>
    <script>
      var elem = strToElement('<div>a<i>b</i>c</div>')
      assert_eq(elem.firstChild.nodeValue, 'a')
      assert_eq(elem.innerHTML,            'a<i>b</i>c')
    </script>
    <script>
      assert_eq(strToElement('<button>Button innerHTML</button>').innerHTML, 'Button innerHTML')
    </script>

    <p>
      TODO are multiple whitespaces preserved? Inconclusive question:
      <a href="http://stackoverflow.com/questions/213845/javascript-removing-whitespace-when-it-shouldnt">http://stackoverflow.com/questions/213845/javascript-removing-whitespace-when-it-shouldnt</a>
      Passing on Firefox 30 and Chromium 34, but maybe unspecified:
      Same for <code>getAttribute</code>.
    </p>
    <script>
      var elem = strToElement('<p>a  b</p>')
      assert_eq(elem.innerHTML, 'a  b')
    </script>
    <p id="innerHTML">a  b</p>
    <script>
      var elem = document.getElementById('innerHTML')
      assert_eq(elem.innerHTML, 'a  b')
    </script>

  <h3>#Selectors</h3>

    <p>Find elements inside other elements.</p>

    <h4>#querySelectorAll</h4>

      <p>Select elements by CSS selector. Very powerful.</p>
      <p>Not supported in IE7.</p>
      <div class="querySelectorAll0">
        <div class="querySelectorAll1">querySelectorAll</div>
      </div>
      <script>
        assert_eq(document.querySelectorAll('.querySelectorAll0 > .querySelectorAll1')[0].innerHTML, 'querySelectorAll')
      </script>

    <h4>#evaluate</h4>

    <p>
      By Xpath. Working Group Note, not REC.
      Implementation status: only not in desktop IE 10 as of 2014:
      <a href="https://developer.mozilla.org/en-US/docs/Web/API/document.evaluate#Browser_compatibility">https://developer.mozilla.org/en-US/docs/Web/API/document.evaluate#Browser_compatibility</a>
      Sample usage: <a href="http://stackoverflow.com/questions/10596417/is-there-a-way-to-get-element-by-xpath-in-javascript/14284815?noredirect=1#comment38086251_14284815">http://stackoverflow.com/questions/10596417/is-there-a-way-to-get-element-by-xpath-in-javascript/14284815?noredirect=1#comment38086251_14284815</a>
    </p>

    <h4>#querySelector</h4>

      <p>Same as <code>querySelectorAll()[0]</code></p>

    <h4>#getElementById</h4>

      <script>
        document.write('<div id="getElementById">getElementByid</div>')
        assert_eq(document.getElementById('getElementById').innerHTML, 'getElementByid')
      </script>

    <h4>#getElementsByClassName</h4>

      <p>
        Not implemented on IE8. Alternatives: http://stackoverflow.com/questions/3808808/how-to-get-element-by-class-in-javascript
        IE8 alternatives: use <code>querySelectorAll</code> or JQuery.
      </p>
      <script>
        document.write('<div class="getElementsByClassName0 getElementsByClassName1">getElementsByClassName</div>')
        assert_eq(document.getElementsByClassName('getElementsByClassName0')[0].innerHTML, 'getElementsByClassName')
      </script>
      <p>
        The return can be either NodeList or HTMLCollection
        depending on browser versions and standard considered.
        In particular, no <code>forEach</code> Array method.
        Good article: https://developer.mozilla.org/en-US/docs/Web/API/Element.getElementsByTagName
      </p>

    <h4>#getElementsByTagName</h4>

      <p>Some special cases have shortcuts for them:</p>
      <script>
        assert_eq(document.getElementsByTagName('body')[0], document.body)
        assert_eq(document.getElementsByTagName('head')[0], document.head)
      </script>

    <h4>#currentScript</h4>

      <p>Get the current script element:</p>

      <script>
        assert_eq(document.currentScript.parentNode, document.body)
      </script>

  <h3>#Element object</h3>

    <p><a href="http://www.w3.org/TR/dom/#element">http://www.w3.org/TR/dom/#element</a></p>
    <p>Inherits <code>Node</code>.</p>

  <h3>#HTMLElement object</h3>

    <p><a href="http://www.w3.org/TR/html5/dom.html#htmlelement">http://www.w3.org/TR/html5/dom.html#htmlelement</a></p>
    <p>Extends element.</p>

  <h3>#outerHTML</h3>

    <p>Like <code>innerHTML</code>, but also includes the tags. Less support than <code>innerHTML</code> but increasing.</p>
    <script>
      assert_eq(strToElement('<div>a<i>b</i>c</div>').outerHTML, '<div>a<i>b</i>c</div>')
    </script>

  <h3>#children</h3>

  <h3>#firstElementChild</h3>

  <h3>#childnodes</h3>

  <h3>#firstChild</h3>

  <h3>#lastChild</h3>

    <p>Test preparation:</p>
    <script>
      var elem = strToElement('<div id="children">a<i>b</i>c</div>')
    </script>

    <p>children and firstElementChild: only elements, no text:</p>
    <script>
      assert_eq(elem.children[0].innerHTML,       'b')
      assert_eq(elem.firstElementChild.innerHTML, 'b')
    </script>

    <p>childNodes and firstChild: include text:</p>
    <script>
      assert_eq(elem.firstChild.nodeValue,    'a')
      assert_eq(elem.childNodes[0].nodeValue, 'a')
      assert_eq(elem.lastChild.nodeValue,     'c')
    </script>

    <p>childNodes is of type NodeList. Therefore no forEach.</p>

  <h3>#parentNode</h3>

  <h3>#nextSibling</h3>

  <h3>#nextElementSibling</h3>

  <h3>#previousSibling</h3>

  <h3>#previousElementSibling</h3>

    <script>
      var elem = strToElement('<div>a<i>b</i>c<i>d</i>e</div>')
      var firstI = elem.children[0]
      assert_eq(firstI.parentNode.tagName, 'DIV')
      assert_eq(firstI.previousSibling.nodeValue, 'a')
      assert_eq(firstI.previousElementSibling, null)
      assert_eq(firstI.nextSibling.nodeValue, 'c')
      assert_eq(firstI.nextElementSibling.innerHTML, 'd')
    </script>

  <h3>#modify DOM</h3>

    <h4>#insertAdjacentHTML</h4>

      <p>Insert string before or after tag.</p>
      <script>
        document.write('<div>a<span id="insertAdjacentHTML">b</span>c</div>')
        var inner = document.getElementById('insertAdjacentHTML')
        inner.insertAdjacentHTML('beforeBegin', ' <b>beforeBegin</b> ')
        inner.insertAdjacentHTML('afterBegin',  ' afterBegin ')
        inner.insertAdjacentHTML('beforeEnd',   ' beforeEnd ')
        inner.insertAdjacentHTML('afterEnd',    ' <b>afterEnd</b> ')
      </script>

    <h4>#insertBefore</h4>

    <h4>#appendChild</h4>

      <p>Insert an element before another.</p>
      <p>Must work with elements: cannot insert string directly. Consider <code>insertAdjacentHTML</code> for that.</p>
      <p>TODO what happens when element exists already? Copy of events? Probably.</p>
      <script>
        var parent = strToElement('<div id="insertBefore">a<i>b</i>c</div>')
        var insertBeforeItalic = parent.children[0]
        var newElem = document.createElement('div');
        newElem.appendChild(document.createTextNode('d'));
        parent.insertBefore(newElem, insertBeforeItalic)
        assert_eq(insertBeforeItalic.previousElementSibling.innerHTML, 'd')
      </script>

    <h4>#insertAfter</h4>

      <p>
        Does not exist, but easily defined with <code>insertBefore</code>.
        http://stackoverflow.com/questions/4793604/how-to-do-insert-after-in-javascript-without-using-a-library
      </p>

    <h4>#removeChild</h4>

      <p>Must get parent first: http://stackoverflow.com/questions/3387427/javascript-remove-element-by-id</p>
      <script>
        //var element = document.getElementById("element-id");
        //element.parentNode.removeChild(element);
      </script>

  <h3>#getAttribute</h3>

  <h3>#setAttribute</h3>

  <h3>#removeAttribute</h3>

    <p><code>setAttribute</code> creates the attribute if it does not exist.</p>
    <script>
      assert_eq(strToElement('<p id="getAttribute"></p>').getAttribute('id'), 'getAttribute')
    </script>

  <h3>#Style</h3>

  <h3>#CSS</h3>

    <p>Get and set CSS attributes.</p>
    <script>
      document.write('<div id="style" style="background-color:green; color:blue;">#style</div>')
      document.getElementById('style').style.backgroundColor = 'red'
    </script>

  <h3>#HTMLElement</h3>

  <h3>#elements</h3>

    <p>
      <code>HTMLElement</code> is the Base element class.
      It is extended by more specific types of element such as <code>HTMLImageElement</code>.
    </p>

    <h4>#createElement</h4>
    <h4>Construction of derived Element types</h4>

      <p>
        The derived element types can be constructed either with <code>document.createElement</code>
        or specific constructors like <code>Image</code>.
      </p>
      <p>
        Both are standard, widely implemented and equivalent. TODO confirm
        <a href="http://stackoverflow.com/questions/6936071/where-are-constructors-such-as-new-image-and-new-option-documented">http://stackoverflow.com/questions/6936071/where-are-constructors-such-as-new-image-and-new-option-documented</a>
        <a href="https://developer.mozilla.org/en/docs/Web/API/HTMLImageElement">https://developer.mozilla.org/en/docs/Web/API/HTMLImageElement</a>
      </p>
      <p>
        <code>new Image</code> vs <code>document.createElement('img')</code>
        <a href="http://stackoverflow.com/questions/6241716/is-there-a-difference-between-new-image-and-document-createelementimg">http://stackoverflow.com/questions/6241716/is-there-a-difference-between-new-image-and-document-createelementimg</a>
      </p>
      <script>
        assert_eq(document.createElement('adsf').constructor, HTMLUnknownElement)
        assert_eq(document.createElement('div') .constructor, HTMLDivElement)
        assert_eq(document.createElement('img') .constructor, HTMLImageElement)
        // TODO Fails on chromium 34. Error, or unspecified?
        //assert_eq((new Image())                 .constructor, HTMLImageElement)
      </script>

    <h4>#createTextNode</h4>

      <p>Not an element, but can be a child.</p>
      <p>Contains the text on the outside of other elements.</p>

    <h4>Create DOM tree from string.</h4>

      <p>
        Convert string to DOM tree of Elements:
        <a href="http://stackoverflow.com/questions/494143/creating-a-new-dom-element-from-an-html-string-using-built-in-dom-methods-or-pro">http://stackoverflow.com/questions/494143/creating-a-new-dom-element-from-an-html-string-using-built-in-dom-methods-or-pro</a>
        <code>innerHTML</code> trick:
      </p>
      <script>
        var str = '<div></div>'
        var dummy = document.createElement('div')
        dummy.innerHTML = str
        var elem = dummy.childNodes[0]
        assert_eq(elem.tagName, 'DIV')
      </script>

    <h4>#focus</h4>

      <p>Method of <code>HTMLElement</code> that gives focus to element.</p>
      <p>
        Not all elements can have focus:
        <a href="http://stackoverflow.com/questions/1599660/which-html-elements-can-receive-focus">http://stackoverflow.com/questions/1599660/which-html-elements-can-receive-focus</a>
      </p>
      <p>
        Get element with focus with <code>activeElement</code>:
        <a href="http://stackoverflow.com/questions/497094/how-do-i-find-out-which-dom-element-has-the-focus">http://stackoverflow.com/questions/497094/how-do-i-find-out-which-dom-element-has-the-focus</a>
        Widely supported. TODO standards?
      </p>

    <h4>#img</h4>

    <h4>#Image</h4>

    <h4>#HTMLImageElement</h4>

      <h5>src</h5>

        <p>
          <code>src</code> attribute: starts loading as soon as it is set.
        </p>
        <button>Click me to set image.</button>
        <img src="i-dont-exist.jpg" alt="flower"/>
        <script>
          ;(function(){
            var img = previousElement()
            var button = img.previousElementSibling
            button.addEventListener(
              'click',
              function() {
                img.src = 'flower.jpg'
              },
              false
            )
          }())
        </script>

      <h5>#complete</h5>

        <p>Set to <code>true</code> when load has finished.</p>
        <p>Set to <code>false</code> when load starts, e.g. <code>img.src = </code>.</p>
        <p>
          Application: do something when image finished loading.
          Must take care not to add the callback after the event happened.
        </p>
        <script>
          //var img1 = document.querySelector('.img-1');
          //function loaded() {
          //  // woo yey image loaded
          //}
          //if (img1.complete) {
          //  loaded();
          //}
          //else {
          //  img1.addEventListener('load', loaded);
          //}
          //img1.addEventListener('error', function() {
          //  // argh everything's broken
          //});
        </script>
        <p>
          The same is not possible for the error event
          since there is no analogous boolean <code>error</code> indicator.
        </p>

    <h4>#textarea</h4>

    <h4>#input</h4>

      <p>Get or set the content with the <code>value</code> property.</p>
      <script>
        document.write(
          '<textarea id="textarea" onkeypress="textarea_func();">default</textarea>' +
          '<div id="textarea-value">Textarea value = <span></span></div>'
        )
        var textarea = document.getElementById('textarea')
        var textarea_value_holder = document.getElementById('textarea-value').lastElementChild
        function textarea_func() {
          textarea_value_holder.innerHTML = textarea.value
        }
        textarea_func()
      </script>

      <p>
        The default value can be retrieved with the <code>defaultValue</code> property:
        it's the text that was put inside the <code>textarea</code> tags in the HTML.
        This differs from <code>input</code> elements,
        where the default value is set through the <code>value</code> property (and can also be retrieved
        with this property).
      </p>

      <h5>#keypress</h5>

      <h5>#keydown</h5>

      <h5>#keyup</h5>

      <h5>#textinput</h5>

      <h5>#change</h5>

      <h5>#input</h5>

        <p>Events that are activated when:</p>
        <ul>
          <li>
            <code>change</code>: value of input element changed.
            Only triggered for input text fields when you <i>lose focus</i> of field
            not on keypress. To do that, use <code>input</code>.
          </li>
          <li>
            <code>input</code>: when the value changes, before losing focus.
          </li>
        </ul>

      <h5>#disabled</h5>

        <p>Property to get or set the disabled state of a form control.</p>

        <input id="prop-disabled" type="text" value="Disabled by JavaScript." />
        <script>
          document.getElementById('prop-disabled').disabled = true;
        </script>

        <input id="prop-enabled" type="text" value="Enabeld by JavaScript." disabled="disabled" />
        <script>
          document.getElementById('prop-enabled').disabled = false;
        </script>

    <h4>#checkbox</h4>

      <h5>#checked</h5>

        <p>Property that gets or sets checked state of checkbox.</p>
        <script>
          var p = strToElement('<p>Click checkbox: <input id="checkbox" type="checkbox" value="1" /></p>')
          checkbox = p.children[0]
          checkbox.addEventListener(
            'change',
            function(even) {
              p.appendChild(document.createTextNode(' ' + even.target.checked))
            },
            false
          )
          insertBeforeScript(p)
        </script>

    <h4>#canvas</h4>

      <p>The HTML canvas element was made to be drawn with JavaScript and destroy Flash.</p>
      <script>
        document.write(
          '<h2>#canvas</h2>' +
          '<canvas id="canvas" width="200" height="100" style="border:1px solid black;"></canvas>' +
          '<div onclick="canvas_onclick()" class="border">canvas_onclick. Click me!</div>'
        )
        function canvas_onclick() {
          var b_canvas = document.getElementById("canvas");
          var b_context = b_canvas.getContext("2d");
          b_context.fillRect(50, 25, 150, 100);
        }
      </script>

<h2>#events</h2>

  <p>Events are part of the DOM.</p>
  <p>Each event is attached to an element.</p>
  <p>Events propagate</p>
  <p>Like the rest of the DOM, it is a bit messy to find where events are defined.</p>
  <p>
    A good source is Firefox's documentation
    <a href="http://www.w3.org/TR/DOM-Level-3-Events">http://www.w3.org/TR/DOM-Level-3-Events</a>
  </p>
  <p>The major standards are:</p>
  <ul>
    <li>DOM related events: <a href="http://www.w3.org/TR/DOM-Level-3-Events">http://www.w3.org/TR/DOM-Level-3-Events</a></li>
    <li>
      Random points of HTML5 like:
      <a href="http://www.w3.org/TR/html5/browsers.html#beforeunloadevent">http://www.w3.org/TR/html5/browsers.html#beforeunloadevent</a>
    </li>
  </ul>

  <h3>#addEventListener</h3>

    <p>
      Allows to add an unlimited amount of handlers per event.
      Better choice than <code>on</code> attributes like <code>onload</code>.
    </p>
    <p>Can be used together with <code>on</code> events. TODO check.</p>
    <p>TODO do all events have a on version and an <code>addEventListener</code> one?</p>

    <h4>#useCapture parameter</h4>

    <h4>#Capture vs #Bubble</h4>

      <p>Determines the order in which listeners listen to the event.</p>
      <p>TODO exactly how, example</p>
      <p>A listener callback ends, the event is then sent to further listeners by default.</p>

    <h4>#stopPropagation</h4>

      <p>
        Prevent event from being listened on further listeners.
        http://stackoverflow.com/questions/4470417/how-do-i-consume-a-key-event-in-javascript-so-that-it-doesnt-propagate
      </p>
      <p>Only implemented in recent IE. Consider jQuery's <code>preventDefault</code> and/or <code>stopPropagation</code> if you care.</p>
      <p>TODO example</p>

    <h4>#dispatchEvent</h4>

    <h4>#Trigger events programmatically</h4>

      <p>
        Programmatically trigger events.
        http://stackoverflow.com/questions/2490825/how-to-trigger-event-in-javascript
      </p>
      <p>TODO example</p>
      <p>
        TODO not possible to trigger standard events like click?
        http://stackoverflow.com/questions/809057/how-do-i-programmatically-click-on-an-element-in-firefox
      </p>
      <div id="dispatchEvent"></div>

  <h3>document vs window vs body events</h3>

    <p>
      <code>document</code>, <code>window</code> and <code>body</code> have different possible events.
      TODO understand clearly.
      <a href="http://stackoverflow.com/questions/12045440/difference-between-document-addeventlistener-and-window-addeventlistener">http://stackoverflow.com/questions/12045440/difference-between-document-addeventlistener-and-window-addeventlistener</a>
      <a href="http://stackoverflow.com/questions/191157/window-onload-vs-body-onload">http://stackoverflow.com/questions/191157/window-onload-vs-body-onload</a>
    </p>
    <p>
      You cannot attach events to the <code>body</code> element form scripts in the head,
      because the body is not yet part of the DOM!
      Prefer to attach events to the <code>document</code> or <code>window</code> objects instead.
    </p>

    <div>#FAIL</div>
    <script>
      // IIFE to isolate `fail`.
      ;(function() {
        var fail = previousElement()
        // TODO: why does document and document.body fail?
        window.addEventListener(
          'load',
          function() {
            fail.parentNode.removeChild(fail)
          },
          false
        )
      }())
    </script>

  <h3>Useful events</h3>

    <h4>#DOMContentLoaded</h4>

      <p>HTML5 http://www.whatwg.org/specs/web-apps/current-work/multipage/the-end.html#the-end</p>
      <p>
        <code>DOMContentLoaded</code> vs <code>document.onload</code>:
        http://stackoverflow.com/questions/2414750/difference-between-domcontentloaded-and-load-events
        Former does not wait for external resources to load, later does.
      </p>
      <p>Used by jQuery's <code>$(document).ready</code> method where supported.</p>

      <div>#FAIL</div>
      <script>
        // IIFE to isolate `fail`.
        ;(function() {
          var fail = previousElement()
          document.addEventListener(
            'DOMContentLoaded',
            function() {
              fail.parentNode.removeChild(fail)
            },
            false
          )
        }())
      </script>

      <script>
        window.onload = function(){
          document.getElementById('window-onload').innerHTML = 'window-onload'
        }
      </script>
      <div id="onload"></div>
      <div id="window-onload"></div>
      <script>
        window.onload = function(){
          document.getElementById('window-onload').innerHTML = 'window-onload'
        }
      </script>

    <h4>#load</h4>

      <p>
        Can only be used on <code>body</code> or elements that load remote sources such as
        <code>img</code>, <code>link</code> or remote <code>script</code> tags.
        Cannot be used on other elements such as <code>div</code>.
      </p>
      <p>
        Both window and document objects have this event:
        http://stackoverflow.com/questions/588040/window-onload-vs-document-onload>
        but <code>document</code>'s is probably more useful.
      </p>
      <p>
        On <code>body</code> and <code>document</code>, waits for all content to load,
        including images.
      </p>
      <p>
        If <code>load</code> has already finished when callback is set, it does not get called.
        Fortunately it is possible to check if load completed with <code>complete</code>:
      </p>
      <script>
        //var img1 = document.querySelector('.img-1');
        //function loaded() {
        //  // woo yey image loaded
        //}
        //if (img1.complete) {
        //  loaded();
        //}
        //else {
        //  img1.addEventListener('load', loaded);
        //}
        //img1.addEventListener('error', function() {
        //  // argh everything's broken
        //});
      </script>
      <p>
        The same is not possible for the error event
        since there is no analogous boolean <code>error</code> indicator.
      </p>

    <h4>#error</h4>

      <p>Something like an image failed to load.</p>
      <p>
        Not fired if event already failed before assigning the listener. TODO: sure?
        For 'load', possible to work around via the <code>complete</code> argument,
        but not for error.
        Source: <a href="http://www.html5rocks.com/en/tutorials/es6/promises/">http://www.html5rocks.com/en/tutorials/es6/promises/</a>
      </p>
      <div>#FAIL</div>
      <script>
        // IIFE to isolate `fail`.
        ;(function() {
          var fail = previousElement()
          var img = document.createElement('img')
          img.addEventListener(
            'error',
            function(even) {
              fail.parentNode.removeChild(fail)
            },
            false
          )
          img.src = 'i-dont-exist.jpg'
        }())
      </script>

      <h5>#window.onerror</h5>

        <p>Catches js exceptions? TODO how is that related to load errors of the 'error' event?</p>

    <h4>#click</h4>

      <script>
        var elem = strToElement('<p class="border" onclick="onclick_func(event)" style="height:100px;">onclick. Click here.</p>')
        var onclick_func = function(e) {
          e.target.innerHTML += ' click'
        }
        insertBeforeScript(elem)
      </script>

      <script>
        var elem = strToElement('<p class="border" style="height:100px;">addEventListener click. Click here.</p>')
        elem.addEventListener(
          'click',
          function(e) {
            e.target.innerHTML += ' click'
          },
          false
        )
        insertBeforeScript(elem)
      </script>

      <p>Works on buttons:</p>
      <script>
        var elem = strToElement('<button>button addEventListener</button>')
        elem.addEventListener(
          'click',
          function(even) {
            even.target.innerHTML += ' click'
          },
          false
        )
        insertBeforeScript(elem)
      </script>

      <h5>#preventDefault</h5>

        <p>
          Don't take the default action that would be taken on an event,
          e.g. open link on anchor click. Works for middle click.
        </p>
        <script>
          var f = function(prevent) {
            var elem = document.createElement('a')
            elem.href = 'http://example.com'
            elem.innerHTML = 'prevent = ' + prevent
            elem.addEventListener(
              'click',
              function(even) {
                alert('click')
                if (prevent) {
                  even.preventDefault()
                }
              },
              false
            )
            insertBeforeScript(elem)
            insertBeforeScript(document.createElement('br'))
          }
          f(true)
          f(false)
        </script>

      <h5>#return value of click callback</h5>

        <p>On DOM0, if return is <code>false</code> then the default action, e.g. open link, is not taken.</p>
        <p>This still works on most browsers, but the W3C way of doing it is <code>preventDefault</code></p>
        <p>jQuery implements this interface on the callback passed to <code>on</code>.</p>

    <h4>#submit event</h4>

    <h4>#submit() method</h4>

      <p>
        Like click but when submitting a form through the submit button.
        Attached to the form itself.
      </p>
      <script>
        var elem = strToElement(
          '<form action="http://example.com" method="post" class="border">' +
            '<button type="submit">Submit</button>' +
          '</form>'
        )
        elem.addEventListener(
          'click',
          function(even) {
            alert('click')
            // Would prevent the submit:
            //even.preventDefault()
          },
          false
        )
        elem.addEventListener(
          'submit',
          function(even) {
            alert('submit')
            even.preventDefault()
          },
          false
        )
        insertBeforeScript(elem)
        insertBeforeScript(document.createElement('br'))
      </script>

      <p>Programmatically submit a form:</p>
      <script>
        var form = document.createElement('form')
        form.action = 'http://example.com'
        form.method = 'post'
        var a = document.createElement('a')
        a.href = '#'
        a.innerHTML = 'Click me to form.submit()'
        a.addEventListener(
          'click',
          function(even) {
            form.submit()
            even.preventDefault()
          },
          false
        )
        insertBeforeScript(form)
        insertBeforeScript(a)
      </script>

    <h3>#beforeunload</h3>

      <p><a href="http://www.w3.org/TR/html5/browsers.html#beforeunloadevent">http://www.w3.org/TR/html5/browsers.html#beforeunloadevent</a></p>
      <p>Before the user exits the current page by either of:</p>
      <ul>
        <li>closing the tab</li>
        <li>closing the entire browser</li>
        <li>clicking a link that would load in current page</li>
        <li>refreshing the current page</li>
      </ul>
      <p>Can be cancelled, preventing the exit.</p>
      <p>How to use: <a href="http://stackoverflow.com/questions/1119289/how-to-show-the-are-you-sure-you-want-to-navigate-away-from-this-page-when-ch">http://stackoverflow.com/questions/1119289/how-to-show-the-are-you-sure-you-want-to-navigate-away-from-this-page-when-ch</a></p>
      <p>TODO:</p>
      <ul>
        <li>
          <code>alert</code> does not work inside the handler,
          probably because otherwise malicious code could prevent you from ever leaving the page.
          Where is this written on HTML5?
        </li>
        <li>
          On Firefox 30, the custom message which should be set with <code>returnValue</code> is not being shown.
          It is known that some browsers don't follow the default and use the actual return value of the
          callback as message, but Firefox should work no?
          Related bug: <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=588292">https://bugzilla.mozilla.org/show_bug.cgi?id=588292</a>
          Docs: <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window.onbeforeunload">https://developer.mozilla.org/en-US/docs/Web/API/Window.onbeforeunload</a>
        </li>
        <li>In HTML5, does <code>preventDefault</code> work?</li>
      </ul>
      <p>
        <button type="button" onclick="beforeunload_events = true; this.innerHTML += ' Activated!'">
          Click me to activate the beforeunload tests!
        </button>
        <a href="http://example.com">Click me to leave the page after activating the beforeunload event.</a>
      </p>
      <script>
        var beforeunload_events = false;
        window.addEventListener(
          'beforeunload',
          function(event) {
            if (beforeunload_events) {
              event.returnValue = 'Are you sure to leave this page?'
            }
          }
        )
      </script>
      <p>
        Application: "Are you sure you want to exit?" while editing large textareas.
        Check if the textarea has been modified since first load, and if yes show the message.
      </p>

<h2>#cookies</h2>

  <p>A way of storing small data strings on user's computer hard disk.</p>
  <p>
    View all cookies on Firefox:
    <a href="chrome://browser/content/preferences/cookies.xul">chrome://browser/content/preferences/cookies.xul</a>
  </p>
  <p>Cookies are accessible through DOM.</p>
  <p>Cookies can be set/get only for current domain.</p>
  <p>
    WARNING: some browsers may not keep cookies for local files (file://)
    so these tests may fail. Current Firefox does keep the cookies.
  </p>
  <p>Each browser stores its own cookies</p>

  <h3>Cookies in HTTP.</h3>
  <h3>Cookies without JavaScript.</h3>

    <p>Cookies can also be set via headers using the <code>Set-Cookie</code> header key.</p>
    <p>Cookies are automatically sent to servers by browsers via the <code>Cookie</code> header value.</p>
    <p>Cookies are sent from servers to CGI scripts via the <code>HTTP_COOKIE</code> env var.</p>
    <p>These are the most reliable methods, there is no need to use js for cookies.</p>

  <h3>#session cookies</h3>

    <p>A cookie based technique to maintain user logged in.</p>
    <ul>
      <li>username/password is sent to server encrypted in some way (HTTP Basic + SSL, POST + SSL)</li>
      <li>
        server authenticates, and creates a large random number, stores it,
        and sends it as a non persistent cookie that is an unique number
      </li>
      <li>
        whenever the user hits another URL, this large number is sent to server.
        and user is logged in.
      </li>
    </ul>
    <p>TODO: how to avoid getting the session hijacked?</p>

<script>
// TODO: convert comments on this script to HTML

  // #Cookies and subdomains

    // TODO By default, cookies can only be set and gotten for a given domain:

    // - `www.example.com`
    // - `example.com`

    // TODO:

    // - domains that start with dot `.`
    // - HTTP cookie headers
    // - document.domain

  // #path

    // Cookies can be set only for the **current** path and its parents.

    // E.g.: in `www.abc.com/a/b.html`, the path is `a/a.html`.
    // so `a.html` can set cookies for `/`, `/a/` and `/a/a.html` from `/a/a.html`

    // If the location is a directory, then all subdirs can also get the cookies.
    // E.g.: cookies set for `/` can be seen on `/a/` and on `/b/`

  // #js interface

    // #Set values

      // Browser parses the strings.

      // Set keys:

        document.cookie = "key=val;"
        document.cookie = "key=val2;"

      // Only `val2` is kept.

      // BAD:

        document.cookie = "key2=val2;key3=val3"

      // Only `key2` is set. Only a single key can be set at a time.

    // #Get values

      // Not possible directly: must parse the `document.cookie` string.

    // #Delete values

      // The simplest technique is to set a past expires date.

  // #Properties

    // Properties are special key/value pairs that contain key metadata.

    // #expires

      // Previous key is deleted by browser at given UTC string date:

        var now = new Date()
        var later = now
        later.setMinutes(now.getMinutes() + 1)
        document.cookie += "keyExp=valExp;expires=" + later.toUTCString()

      // If expires is not given, then the cookie expires when the browser is closed!

      // It is not possible to make a cookie that never expires,
      // only one with a huge expiry date.

    // #path

      // Cookie path.

      // Defaults to current file/dir.

      // Can only be set for parent dirs of current path.

    // #safe

      // If set to exactly `= safe`, this cookie will only be sent over `https`, not `http`

        document.cookie = "keySafe=v;safe"

      // TODO confirm usage correct

    // #HttpOnly

      // Instructs server not to pass the cookie to CGI scripts.

      // This can increase security of session cookies.

      // <http://www.codinghorror.com/blog/2008/08/protecting-your-cookies-httponly.html>

        document.cookie = "keySafe=v;HttpOnly"

  // #Higher level interface

    // The JavaScript cookie interface is very low level and inconvenient.

    // jquery-cookie <https://github.com/carhartl/jquery-cookie> is on popular and convenient cookie interface based on JQuery.

    // #helpers

      // - c_name: string
      // - value: string
      // - exdays: integer. Number of days which will take for the cookie to expire.
      //
      function setCookie(c_name, value, exdays) {
        var exdate = new Date()
        exdate.setDate(exdate.getDate() + exdays)
        var c_value = escape(value) + ((exdays==null) ? "" : "; expires=" + exdate.toUTCString())
        document.cookie = c_name + "=" + c_value
      }

      // c_name: string
      // @return: null if not found, value if found
      //
      function getCookie(c_name) {
        var i, x, y, ARRcookies = document.cookie.split(";")
        for (i = 0; i < ARRcookies.length; i++) {
          x = ARRcookies[i].substr(0, ARRcookies[i].indexOf("="))
          y = ARRcookies[i].substr(ARRcookies[i].indexOf("=") + 1)
          x = x.replace(/^\s+|\s+$/g, "")
          if (x == c_name) {
            return unescape(y)
          }
        }
      }

      function delCookie(name, path, domain) {
        if (Get_Cookie(name))
          document.cookie=name+"="+((path) ? ";path="+path:"")+((domain)?";domain="+domain:"") +
                        ";expires=Thu, 01 Jan 1970 00:00:01 GMT"
      }

  document.write('<h2>cookies</h2>' + document.cookie + '<br>')
</script>

<h2>#XHR</h2>

<h2>#XMLHttpRequest</h2>

<h2>#AJAX</h2>

  <p>Make server requests without reloading the current page.</p>
  <p>
    W3C WD: <a href="http://www.w3.org/TR/XMLHttpRequest/">http://www.w3.org/TR/XMLHttpRequest/</a>,
    widely implemented.
  </p>
  <p>The name is only historical and currently horrible, as this object can:</p>
  <ul>
    <li>receive and send any data, not just XML</li>
    <li>receive and send other request types besides HTTP, e.g. FTP</li>
  </ul>
  <p>
    so neither <code>XML</code> nor <code>HTTP</code> in the name make sense anymore,
    should be just <code>Request</code>...
  </p>
  <p>
    TODO I'm confused about what is the difference between level 1 and level 2.
    It seems that in the past, there ware two W3C documents, XMLHttpRequest and XHMLHttpRequest2
    <a href="http://www.w3.org/TR/XMLHttpRequest2/">http://www.w3.org/TR/XMLHttpRequest2/</a>
    Now it the level 2 latest version points to the level 1 URL, so I imagine they have been merged,
    and that the only difference is informal between old and new methods, so:
    both level 1 and 2 have the same constructor,
    but level 2 extends level 1 with further capabilities if implemented.
  </p>
  <p>
    Not a part of ES, thus not available in Node.js.
    <a href="https://github.com/driverdan/node-XMLHttpRequest">node-XMLHttpRequest</a>
    is a wrapper for Node.js's stdlib HTTP implementation with interface exactly like this browser object.
  </p>
  <p>
    jQuery has an almost extension of XHR called <code>jqXHR</code>:
    it contains most, but not all, properties of XHR, plus some extra behavior,
    and is used by the jQuery API instead of the plain XHR.
  </p>
  <p>Overview:</p>
  <script>
    var xmlhttp = new XMLHttpRequest()
    xmlhttp.open('GET',  'ajax/url', true)
    //xmlhttp.open('GET',  'ajax/url?a=1&b=2', true)
    //xmlhttp.open('POST', 'ajax/url', true)
    //xmlhttp.open('POST', 'ajax/url', true)
    xmlhttp.setRequestHeader('X-Requested-With', 'XMLHttpRequest')
    xmlhttp.onreadystatechange = function() {
      if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
        document.getElementById("myDiv").innerHTML = xmlhttp.responseText
        // Only if if the response is XML:
        //xmlDoc = xmlhttp.responseXML
        //x = xmlDoc.getElementsByTagName("ARTIST")
        //for (i = 0; i < x.length; i++) {
        //  txt=txt + x[i].childNodes[0].nodeValue + "<br>"
        //}
      }
      //xmlhttp.send()

      // POST data:
      //xmlhttp.send("fname=Henry&lname=Ford")
    }
  </script>
  <p>TODO: is <code>Content-Length</code> required?</p>

  <h3>#open</h3>

    <p>Set basic request info. Does not send the request yet.</p>
    <p>Open signature: <code>open(method,url,async)</code></p>
    <p>Post data is set at <code>send</code>.</p>

  <h3>#setRequestHeader</h3>

    <p>Allows full control over the HTTP headers.</p>
    <p>Many JS libraries add the following to the header:</p>

  <h3>#response</h3>

  <h3>#onreadystatechange</h3>

    <p>Response should be used from a callback function on asynchronous mode.</p>
    <p><code>onreadystatechange</code> callback is called every time the <code>readyState</code> property changes.</p>
    <p>Its possible values are:</p>
    <ul>
      <li>0: request not initialized</li>
      <li>1: server connection established</li>
      <li>2: request received</li>
      <li>3: processing request</li>
      <li>4: request finished and response is ready</li>
    </ul>
    <p>It is typical for the state to go through all of those states.</p>
    <p>TODO how does the server inform which state we are currently on?</p>

      <h4>#responseText</h4>

        <p>Field always present: contains the plain response.</p>

      <h4>#responseXML</h4>

        <p>Field only present if the response type is specified XML on the HTTP headers.</p>

  <h3>#send</h3>

    <p>Actually make the request.</p>

  <h3>#Cross-origin XHR</h3>

  <h3>#Same origin policy</h3>

  <h3>#SOP</h3>

    <p>
      <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy">https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy</a>
    </p>
    <p>
      For security reasons, browsers don't let you <b>read</b> HTTP requests
      to different locations other than the current one by default.
    </p>
    <p>
      Simple attack examples:
      <a href="http://stackoverflow.com/questions/14667189/simple-example-for-why-same-origin-policy-is-needed">http://stackoverflow.com/questions/14667189/simple-example-for-why-same-origin-policy-is-needed</a>
    </p>
    <p>The most common things that this forbids are:</p>
    <ul>
      <li>making an XHR to another domain</li>
      <li>reading the content of an <code>iframe</code> if it points to another domain</li>
    </ul>
    <p>
      It is however perfectly possible to make cross site requests in HTML:
      every external hyper link and image tag makes such <code>GET</code> request,
      and nothing prevents a form from doing a <code>POST</code> request across domains.
      Preventing such requests would make the web unusable: the only thing that <i>is</i> forbidden
      is <b>reading</b> that information into JavaScript.
    </p>
    <p>
      The reason why it is not possible with XHR is that the <code>send</code>
      always allows the JavaScript to read the request response.
    </p>
    <p>
      It is however possible to make requests from JavaScript using
      other techniques, which do not allow to read the response, and thus do not violate
      the SOP, in particular:
    </p>
    <ul>
      <li>
        create a form in an <code>iframe</code> and trigger the submit with JavaScript,
        <a href="http://stackoverflow.com/questions/298745/how-do-i-send-a-cross-domain-post-request-via-javascript">http://stackoverflow.com/questions/298745/how-do-i-send-a-cross-domain-post-request-via-javascript</a>
      </li>
      <li>if you control the remote server, CORS is the perfect option</li>
    </ul>
    <p>
      Since it is a security principle like "don't publicly post your password",
      there are not standards that specify it: only security best practices.
      <a href="http://stackoverflow.com/questions/11423682/cross-domain-form-posting">http://stackoverflow.com/questions/11423682/cross-domain-form-posting</a>
    </p>
    <p>
      The same origin policy is the basis for the Synchronizer Token Pattern that prevents CSRF.
      If it were not used, then the attacker could obtain the token and make the request.
      <a href="https://www.owasp.org/index.php/Cross-Site_Request_Forgery_%28CSRF%29_Prevention_Cheat_Sheet">https://www.owasp.org/index.php/Cross-Site_Request_Forgery_%28CSRF%29_Prevention_Cheat_Sheet</a>
    </p>
    <p>Some browsers have an option to allow that to happen for testing purposes.</p>
    <p>If an <code>XHR</code> is blocked on SOP basis, you will get <code>xmlhttp.status == 0</code>.</p>

    <h4>#iframe SOP example</h4>

      <iframe id="iframe-other-origin" style="width:300px; height:300px;">Could not access example.com</iframe>
      <iframe id="iframe-same-origin" src="html2.html" style="width:300px; height:300px;"></iframe>
      <script>
        // Fails on localhost
        //document.getElementById('iframe-same-origin').addEventListener(
        //  'load',
        //  function(e) {
        //    assert_neq(e.target.contentDocument.body.innerHTML, '')
        //  }
        //)
        //assert_eq(document.getElementById('iframe-same-origin').contentDocument.body.innerHTML, '')

        document.getElementById('iframe-other-origin').addEventListener(
          'load',
          function(e) {
            assert_eq(e.target.contentDocument.body.innerHTML, '')
          }
        )
      </script>

    <h4>XHR SOP example</h4>

      <p>On the Firefox inspector, those requests get logged under Console &gt; Security.</p>
      <script>
        var xmlhttp

        // On file://, this exits `status == 0`, but security is not logged.

        //xmlhttp = new XMLHttpRequest()
        //xmlhttp.open('GET', 'html2.html', true)
        //xmlhttp.onreadystatechange = function() {
        //  if (xmlhttp.readyState == 4) {
        //    assert_eq(xmlhttp.status, 200)
        //  }
        //}
        //xmlhttp.send()

        // TODO: if the non SOP is done, then the above request never happens. Why?

        //xmlhttp = new XMLHttpRequest()
        //xmlhttp.open('GET', 'http://example.com', true)
        //xmlhttp.onreadystatechange = function() {
        //  if (xmlhttp.readyState == 4) {
        //    assert_eq(xmlhttp.status, 0)
        //  }
        //}
        //xmlhttp.send()
      </script>

    <h4>#XHR on file:// protocol</h4>

      <p>Apparently not possible.</p>
      <p>
        does not make much sense, since <code>file://</code>
        does not take HTTP requests, and XHR stands for XML HTTP requests.
      </p>
      <p>On Firefox, <code>readyState</code> reaches 4, but <code>status</code> is 0.</p>

    <h4>#CORS</h4>

    <h4>#Cross-origin resource sharing</h4>

      <p>
        Jan 2014 W3C REC that enables cross origin XHR requests in a controlled manner.
        <a href="http://www.w3.org/TR/cors/">http://www.w3.org/TR/cors/</a>.
        Part of XHR2.
        As of Jul 2014, widely implemented on the most recent version of browser families,
        and plugins exist for most major server systems, including Apache, Nginx, Rack, etc.
      </p>
      <p>Promotional website: <a href="http://enable-cors.org/">http://enable-cors.org/</a></p>
      <p>
        On the JavaScript side nothing needs to be done on XHR2:
        if the server supports CORS, you do nothing.
      </p>
      <p>
        Browser and server implementors several headers to deal with, and one extra request.
        Simple tutorial including the HTTP interface:
        <a href="http://www.html5rocks.com/en/tutorials/cors/">http://www.html5rocks.com/en/tutorials/cors/</a>
      </p>
      <p>
        For a CORS request to be doable, the server must support it, and allow it for the safe pages of course.
      </p>

  <h3>#responseType</h3>

    <p>Set the response type request header. TODO check.</p>

<h2>#File API</h2>

  <p>Local file IO.</p>
  <p>W3C spec: <a href="http://www.w3.org/TR/file-upload/">http://www.w3.org/TR/file-upload/</a></p>
  <p>Tutorial: <a href="http://www.html5rocks.com/en/tutorials/file/dndfiles/">http://www.html5rocks.com/en/tutorials/file/dndfiles/</a></p>
  <p>The file API is purposefully restricted in many aspects for security.</p>
  <p>For example, you cannot get directory listings: all path selections are done through the browser's built-in popup.</p>

  <h3>#upload</h3>

    <p>The first thing you have to do is get the files from the user.</p>
    <p>There are two main methods:</p>
    <ul>
      <li><code>input type="file"</code></li>
      <li>drag and drop</li>
    </ul>
    <p>
      Naturally, for security reasons you can't just read file paths from the user's computer:
      he has to explicitly take some action to give you the files.
    </p>

    <h4>input type=file</h4>

      <p>TODO</p>

    <h4>#Drag and Drop file upload</h4>

      <p>
        The <code>drop</code> event has a <code>dataTransfers.file</code> property,
        which contains a list of File API <code>File</code> objects.
        Therefore, it is possible to do drag and drop file upload in HTML5!
      </p>
      <p>
        Worse method than <code>input type=file</code>, because it is only usable from large screens
        and you can have multiple windows open and suitably positioned.
      </p>
      <p>
        The advantage of drag and drop is that if you already have a file browser open,
        you don't have to search for the file path again.
      </p>
      <p>
        Some browsers like Firefox 31 support drag and drop into a regular <code>input type=file</code> element.
        This would be the perfect behaviour, allowing both input methods in one, but unfortunately it seems that it is not standardized:
        <a href="http://stackoverflow.com/questions/2677565/how-to-drag-and-drop-file-attachment-into-the-browser">http://stackoverflow.com/questions/2677565/how-to-drag-and-drop-file-attachment-into-the-browser</a>
      </p>

      <div id="file-drop" style="border:1px dashed black; height:300px; width:300px;">Drop files here!</div>
      <script>
        var file_drop = document.getElementById('file-drop');
        // TODO why is this necessary? If I leave it out,
        // dragging something into the browser makes it open the file instead.
        file_drop.addEventListener(
          'dragover',
          function handleDragOver(evt) {
            evt.stopPropagation()
            evt.preventDefault()
            // TODO: what is this?
            evt.dataTransfer.dropEffect = 'copy'
          },
          false
        )
        file_drop.addEventListener(
          'drop',
          function(evt) {
            evt.stopPropagation()
            evt.preventDefault()
            var files = evt.dataTransfer.files  // FileList object.
            var file = files[0]                  // File     object.
            alert(file.name)
          },
          false
        )
      </script>

      <p>Now try dragging the image into the drop area: <code>file</code> is now undefined.</p>
      <img src="flower.jpg" alt="flower"/>

  <h3>Using the files</h3>

    <p>There is a limited amount of information you can get from files:</p>
    <ul>
      <li><code>name</code>: the basename</li>
      <li><code>lastModifiedDate</code>: <code>Date</code> object</li>
      <li><code>size</code>: in bytes</li>
    </ul>
    <p>The spec explicitly says that you can't get the full path.</p>
    <p>
      To get the contents of a <code>File</code>, you must use the <code>FileReader</code> object on it,
      which allows for flexible asynchronous data read in chunks.
    </p>

  <h3>Directory upload</h3>

    <p>Seems not to be possible.</p>
    <p>
      Through drag and drop:
      <a href="http://stackoverflow.com/questions/3590058/does-html5-allow-drag-drop-upload-of-folders-or-a-folder-tree">http://stackoverflow.com/questions/3590058/does-html5-allow-drag-drop-upload-of-folders-or-a-folder-tree</a>
      Already implemented in Chrome 21, but not standardized.
    </p>
    <p>
      Through <code>input type=file</code>:
      <a href="http://stackoverflow.com/questions/9518335/select-directory-for-html5-multiple-file-input-in-firefox">http://stackoverflow.com/questions/9518335/select-directory-for-html5-multiple-file-input-in-firefox</a>
    </p>

  <h3>#download file</h3>

    <p><a href="http://stackoverflow.com/questions/2897619/using-html5-javascript-to-generate-and-save-a-file">http://stackoverflow.com/questions/2897619/using-html5-javascript-to-generate-and-save-a-file</a></p>
    <p>
      Note that file download can be achieved with an <code>href download="filename"</code>,
      so if the file is generated server side, the cleanest way is to make it available on a URL and use it.
    </p>
    <p>
      If the file is generated by client on the browser by JavaScript,
      things are complicated, and probably the best option is to use <a href="https://github.com/eligrey/FileSaver.js/">https://github.com/eligrey/FileSaver.js/</a>
    </p>
    <p>Possible but imperfect HTLM5 solutions include:</p>
    <ul>
      <li>
        generate a <code>download</code> link with a <code>data:</code> URL.
        Fails in some browsers. Size limitations.
      </li>
      <li><code>window.saveAs</code>: not in HTML5</li>
      <li><code>FileSaver</code> API was considered for HTML5 by was dropped</li>
    </ul>

    <h4>#download drag and drop</h4>

      <p>
        Possible as a magic Chrome extension, but not in any standard:
        <a href="http://stackoverflow.com/questions/5416748/drag-a-file-from-browser-to-desktop">http://stackoverflow.com/questions/5416748/drag-a-file-from-browser-to-desktop</a>
      </p>

<h2>#WebRTC</h2>

  <p>Web Real Time Communication.</p>
  <p>Developed by Chrome and Mozilla (probably to counter Skype)</p>
  <p>W3C WD: <a href="http://www.w3.org/TR/webrtc/">http://www.w3.org/TR/webrtc/</a></p>
  <p>HTML5 rocks: <a href="http://www.html5rocks.com/en/tutorials/webrtc/basics/">http://www.html5rocks.com/en/tutorials/webrtc/basics/</a></p>
  <p>Publicity page demo section: <a href="http://www.webrtc.org/demo">http://www.webrtc.org/demo</a></p>

<h2>#Web Audio API</h2>

  <p>Advanced audio control.</p>
  <p>W3C spec.</p>
  <p>Tutorial: <a href="http://www.html5rocks.com/en/tutorials/webaudio/intro/">http://www.html5rocks.com/en/tutorials/webaudio/intro/</a></p>

<h2>#WebGL</h2>

  <p>OpenGL for the browser.</p>
  <p>W3C spec.</p>
  <p>Wide support on desktop browsers.</p>

<h2>#Geolocation API</h2>

  <p>JavaScript access to the device's location, like GPS or other methods.</p>
  <p>W3C spec: <a href="http://www.w3.org/TR/geolocation-API/">http://www.w3.org/TR/geolocation-API/</a></p>
  <p>HTML5 intro: <a href="http://www.html5rocks.com/en/tutorials/geolocation/trip_meter/">http://www.html5rocks.com/en/tutorials/geolocation/trip_meter/</a></p>
  <p>
    The browser may require your permission to give those informations to the JavaScript.
    Firefox shows: "Would you like to share your location with the file ...?"
  </p>
  <p>Many sources can be used to get the location, including the IP address and a GPS if present.</p>
  <script>
    var geoFunc = function() {
      navigator.geolocation.getCurrentPosition(function(position) {
        document.getElementById('geolocation').innerHTML =
          position.coords.latitude + ' ' + position.coords.longitude
      })
    }
  </script>
  <div>
    <button onclick="geoFunc();" type="button">Show position.</button>
    latitude longitude = <span id="geolocation"></span>
  </div>

<h2>#Orientation API</h2>

  <p>Accelerometers, gyroscopes and compasses, present specially in mobile devices like phones.</p>
  <p>HTML5 intro: <a href="http://www.html5rocks.com/en/tutorials/device/orientation/">http://www.html5rocks.com/en/tutorials/device/orientation/</a></p>

<h2>#Notifications API</h2>

  <p>Last call: <a href="http://www.w3.org/TR/notifications/">http://www.w3.org/TR/notifications/</a></p>
  <p><a href="http://www.sitepoint.com/introduction-web-notifications-api/">http://www.sitepoint.com/introduction-web-notifications-api/</a></p>

  <p>TODO get working on Chromium</p>
  <button type="button">Generate notifications in 2 seconds. Try changing desktop windows in the meantime.</button>
  <script>
    previousElement().addEventListener(
      'click',
      function() {
        window.setTimeout(
          function() {
            Notification.requestPermission(function() {
              var notification = new Notification('Notification title', { body: 'Body' })
              var notification2 = new Notification('Notification title 2', { body: 'Body 2' })
            })
          },
          1000
        )
      }
    )
  </script>

<h2>#Server sent events</h2>

<h2>#SSE</h2>

<h2>#Push notifications to browser</h2>

<h2>#HTTP server push</h2>

<h2>#HTTP streaming</h2>

  <p><a href="http://www.w3.org/TR/eventsource/">http://www.w3.org/TR/eventsource/</a></p>
  <p><a href="http://caniuse.com/#feat=eventsource">http://caniuse.com/#feat=eventsource</a></p>
  <p><a href="http://en.wikipedia.org/wiki/Push_technology#HTTP_server_push">http://en.wikipedia.org/wiki/Push_technology#HTTP_server_push</a>/p>
  <p><a href="http://en.wikipedia.org/wiki/Server-sent_events">http://en.wikipedia.org/wiki/Server-sent_events</a></p>
  <p><a href="http://stackoverflow.com/questions/12352341/server-send-push-notification-to-client-browser-without-using-polling">http://stackoverflow.com/questions/12352341/server-send-push-notification-to-client-browser-without-using-polling</a></p>
  <p><a href="http://stackoverflow.com/questions/1964494/how-to-make-all-connected-browsers-reload-initiated-by-a-server-side-event">http://stackoverflow.com/questions/1964494/how-to-make-all-connected-browsers-reload-initiated-by-a-server-side-event</a></p>

<h2>#Extensions</h2>

  <h3>#asm.js</h3>

    <p>Mozilla subset of JavaScript that can be compiled.</p>
    <p>Work in progress, only implemented on very recent Firefox.</p>
    <p>
      Subset so small that although Turing complete it is not practical to write directly:
      it is meant to be transpiled from C++ using LLVM + Emscripten.
    </p>

<h2>#Third party</h2>

  <h3>#cdnjs</h3>

    <p><a href="https://cdnjs.com/">https://cdnjs.com/</a></p>
    <p>
      Very popular peer reviewed CDN. Source and discussions at:
      <a href="https://github.com/cdnjs/cdnjs">https://github.com/cdnjs/cdnjs</a>
    </p>
    <p>Great way to search for new libraries when you need to do something.</p>

  <h3>#RequireJS</h3>

  <h3>#AMD</h3>

  <h3>#CommonJS</h3>

  <h3>#Browserify</h3>

    <p><a href="http://stackoverflow.com/questions/16521471/relation-between-commonjs-amd-and-requirejs">http://stackoverflow.com/questions/16521471/relation-between-commonjs-amd-and-requirejs</a></p>
    <p>
      AMD and CommonJS are specifications that besides other things describe
      how to modularize JavaScript code.
    </p>
    <p>
      RequireJS is the major implementation of AMD.
      If it a single file regular JavaScript library.
    </p>
    <p>Node.js implements CommonJS.</p>
    <p>AMD is a fork of CommonJS.</p>
    <p>AMD is more popular in browsers, CommonJS outside.</p>
    <p>
      AMD loads asynchronously, CommonJS synchronously. This is a major divergence point,
      and explains why AMD is more popular on browsers.
    </p>
    <p>
      The Browserify utility implements CommonJS for the browser,
      by pre-compiling multiple files into one before serving.
    </p>

    <h4>#RequireJs</h4>

      <p>Simple examples demo: <a href="http://www.ringabell.org/en/un-simple-guide-pour-debuter-avec-requirejs/">http://www.ringabell.org/en/un-simple-guide-pour-debuter-avec-requirejs/</a></p>
      <p>Large multi file example: <a href="https://github.com/requirejs/example-multipage">https://github.com/requirejs/example-multipage</a></p>

<h2>#Design patterns</h2>

  <h3>Tabs</h3>

    <p>Possibilities for Js-only tabs:</p>
    <ul>
      <li>buttons, not links. Downside: there is not URL that points to a given tab. Upside: clean URLs.</li>
      <li>
        fragment links. Implemented by jQuery UI. Downside: takes up your fragment.
        Downside if badly implemented like in jQuery UI 1.11: no URLs that point to tabs.
      </li>
      <li>query parameter. Downside: uglier than fragments.</li>
    </ul>

    <p>
      The only clean solution however is to integrate tabs with the server side,
      and decide which tab is open based on the URL <code>path</code>.
    </p>
</body>
</html>
